-- This file is automatically generated

with

type_of_event as (
    select * from "IGI_PROD_DW"."dbo"."TYPEOFEVENT"
),

ordered as (
    select
        LEVENTKEY,
        SEVENTCODE,
        SEVENTDESC,
        DTDOLPERIODFR,
        DTDOLPERIODTO,
        SNOTES,
        SSEARCHEVENTDESC,
        bAuthorized,
        dw_loadts,
        row_number() over (
            partition by
                LEVENTKEY,
                SEVENTCODE,
                SEVENTDESC,
                DTDOLPERIODFR,
                DTDOLPERIODTO,
                SNOTES,
                SSEARCHEVENTDESC,
                bAuthorized
            order by
                dw_loadts
        ) as dw_extract_order
    from
        type_of_event
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        LEVENTKEY,
        SEVENTCODE,
        SEVENTDESC,
        DTDOLPERIODFR,
        DTDOLPERIODTO,
        SNOTES,
        SSEARCHEVENTDESC,
        bAuthorized,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by LEVENTKEY order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged