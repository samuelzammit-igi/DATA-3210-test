-- This file is automatically generated


with

currency as (
    select * from "IGI_PROD_DW"."dbo"."Currency"
),

ordered as (
    select
        lCurrencyKey,
        sCcy,
        sDescription,
        sDescriptionSearch,
        dROE,
        bBase,
        bPrime,
        bEuro,
        dtWithdrawn,
        sSymbol,
        lTypeofCodeSetKey,
        sISOCurrencyNumber,
        bWithdrawn,
        dtJoinedEuro,
        dw_loadts,
        row_number() over (
            partition by
                lCurrencyKey,
                sCcy,
                sDescription,
                sDescriptionSearch,
                dROE,
                bBase,
                bPrime,
                bEuro,
                dtWithdrawn,
                sSymbol,
                lTypeofCodeSetKey,
                sISOCurrencyNumber,
                bWithdrawn,
                dtJoinedEuro
            order by
                dw_loadts
        ) as dw_extract_order
    from
        currency
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lCurrencyKey,
        sCcy,
        sDescription,
        sDescriptionSearch,
        dROE,
        bBase,
        bPrime,
        bEuro,
        dtWithdrawn,
        sSymbol,
        lTypeofCodeSetKey,
        sISOCurrencyNumber,
        bWithdrawn,
        dtJoinedEuro,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lCurrencyKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged