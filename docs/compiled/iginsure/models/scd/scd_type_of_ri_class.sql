-- This file is automatically generated

with

type_of_ri_class as (
    select * from "IGI_PROD_DW"."dbo"."typeofriclass"
),

ordered as (
    select
        lTypeofRIClassKey,
	    sTypeofRIClassCode,
	    sTypeofRIClassDescr,
	    sSearchTypeofRIClassDescr,
	    sRiskPrefix,
	    lTypeOfRIBasisKey,
	    lProductKey,
        dw_loadts,
        row_number() over (
            partition by
                lTypeofRIClassKey,
                sTypeofRIClassCode,
                sTypeofRIClassDescr,
                sSearchTypeofRIClassDescr,
                sRiskPrefix,
                lTypeOfRIBasisKey,
                lProductKey
            order by
                dw_loadts
        ) as dw_extract_order
    from
        type_of_ri_class
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lTypeofRIClassKey,
	    sTypeofRIClassCode,
	    sTypeofRIClassDescr,
	    sSearchTypeofRIClassDescr,
	    sRiskPrefix,
	    lTypeOfRIBasisKey,
	    lProductKey,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lTypeofRIClassKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged