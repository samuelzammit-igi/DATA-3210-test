create view "dbt_szammit"."scd_journal_template__dbt_tmp" as
    -- This file is automatically generated

with

journal_template as (
    select * from "IGI_PROD_DW"."dbo"."TemplateJournalActivity"
),

ordered as (
    select
        lTemplateJournalActivityKey,
        lSourceEntityKey,
        lSourceInstancePropertyKey,
        lSourceEntityStateKey,
        lDivisionERKey,
        lDivisionEPKey,
        lSubDivisionERKey,
        lSubDivisionEPKey,
        lAccountPeriodERKey,
        lAccountPeriodEPKey,
        lROEDateERKey,
        lROEDateEPKey,
        bUseAccountPeriodRates,
        bPostNetResult,
        sTemplateDescription,
        bHardCodeAccelerated,
        dw_loadts,
        row_number() over (
            partition by
                lTemplateJournalActivityKey,
                lSourceEntityKey,
                lSourceInstancePropertyKey,
                lSourceEntityStateKey,
                lDivisionERKey,
                lDivisionEPKey,
                lSubDivisionERKey,
                lSubDivisionEPKey,
                lAccountPeriodERKey,
                lAccountPeriodEPKey,
                lROEDateERKey,
                lROEDateEPKey,
                bUseAccountPeriodRates,
                bPostNetResult,
                sTemplateDescription,
                bHardCodeAccelerated
            order by
                dw_loadts
        ) as dw_extract_order
    from
        journal_template
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lTemplateJournalActivityKey,
        lSourceEntityKey,
        lSourceInstancePropertyKey,
        lSourceEntityStateKey,
        lDivisionERKey,
        lDivisionEPKey,
        lSubDivisionERKey,
        lSubDivisionEPKey,
        lAccountPeriodERKey,
        lAccountPeriodEPKey,
        lROEDateERKey,
        lROEDateEPKey,
        bUseAccountPeriodRates,
        bPostNetResult,
        sTemplateDescription,
        bHardCodeAccelerated,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lTemplateJournalActivityKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged
