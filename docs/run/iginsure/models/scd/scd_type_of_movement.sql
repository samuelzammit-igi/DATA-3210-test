create view "dbt_szammit"."scd_type_of_movement__dbt_tmp" as
    -- This file is automatically generated

with

type_of_movement as (
    select * from "IGI_PROD_DW"."dbo"."TypeOfMovement"
),

ordered as (
    select
        lTypeOfMovementKey,
        sType,
        sTypeSearch,
        lTypeOfAccountActivityKey,
        lTypeOfPayableReceivableKey,
        lRevTypeOfPayableReceivableKey,
        lTypeOfMonetaryAmountKey,
        lRevTypeofMovementKey,
        bReinsurance,
        lReinstatementTypeofMovementKey,
        bReversal,
        dw_loadts,
        row_number() over (
            partition by
                lTypeOfMovementKey,
                sType,
                sTypeSearch,
                lTypeOfAccountActivityKey,
                lTypeOfPayableReceivableKey,
                lRevTypeOfPayableReceivableKey,
                lTypeOfMonetaryAmountKey,
                lRevTypeofMovementKey,
                bReinsurance,
                lReinstatementTypeofMovementKey,
                bReversal
            order by
                dw_loadts
        ) as dw_extract_order
    from
        type_of_movement
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lTypeOfMovementKey,
        sType,
        sTypeSearch,
        lTypeOfAccountActivityKey,
        lTypeOfPayableReceivableKey,
        lRevTypeOfPayableReceivableKey,
        lTypeOfMonetaryAmountKey,
        lRevTypeofMovementKey,
        bReinsurance,
        lReinstatementTypeofMovementKey,
        bReversal,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lTypeOfMovementKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged
