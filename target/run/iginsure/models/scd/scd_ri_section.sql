create view "dbt_szammit"."scd_ri_section__dbt_tmp" as
    -- This file is automatically generated

with

ri_section as (
    select * from "IGI_PROD_DW"."dbo"."RISection"
),

ordered as (
    select
        lRISectionKey,
        lRIActivityKey,
        lRIPolicyKey,
        lRIFolderKey,
        sReference,
        nVersion,
        dtPeriodFrom,
        dtPeriodTo,
        bAutoProfiling,
        lWrittenAccountPeriodKey,
        lTypeOfClassKey,
        lTypeOfLimitBasisKey,
        lCurrencyKey,
        dROE,
        dLimit,
        dExcessOf,
        bFixedCession,
        dCessionPc,
        dMaxCessionAmount,
        dMaxAggregate,
        bClaimCooperation,
        dClaimCooperationTrigger,
        dCashLossTrigger,
        dClaimAdviceTrigger,
        dClaimNotificationTrigger,
        bClaimsFeesRecoverable,
        dTotalBrokerOrderPC,
        lAllRiskTypeOfDeductibleKey,
        lARDTypeOfApplicablePeriodKey,
        dAllRiskDeductible,
        dAllRiskMinDeductible,
        dAllRiskMaxDeductible,
        lPremiumRetainedPC,
        lStatementFrequencyKey,
        lStatementInterval,
        dPremRetainedInterestPC,
        lRISectionChainKey,
        lTypeOfInstalmentKey,
        nInterval,
        bOverideToSingle,
        lDueDateModifierKey,
        nFixedInstalmentNumber,
        bCustomInstalments,
        nTermsOfTradeDays,
        dtFirstInstalmentDueDate,
        bDisplayMD,
        bCashLoss,
        bUnlimitedReinstatements,
        nCountOfDisplayReinstatements,
        nHasPremium,
        bApplyLimitsToCessionPC,
        dTotalInstalmentsPC,
        bAllCoveragesIncluded,
        dLimit100,
        lTypeOfRIBasisKey,
        dEventLimit,
        dExcess,
        dDeductible,
        bFronting,
        lTypeofRIClassKey,
        lTypeofRILayerClassKey,
        lTypeofBasisIncomeKey,
        lTypeofPaymentDueKey,
        lOrigCcyOfRiensAggLimitKey,
        nNoOfRiens,
        dRiensAggLimit,
        lBaseOfRiensKey,
        lFrontingKey,
        lPremiumRetainedOffShorePC,
        lPremiumRetainedOnShorePC,
        lPremiumRetainedMarinePC,
        lMarketLeaderKey,
        ltypeofPremiumPaymentWarrantyKey,
        dTotalTreatyPropPc,
        bFacFollowInwardInstalment,
        dw_loadts,
        row_number() over (
            partition by
                lRISectionKey,
                lRIActivityKey,
                lRIPolicyKey,
                lRIFolderKey,
                sReference,
                nVersion,
                dtPeriodFrom,
                dtPeriodTo,
                bAutoProfiling,
                lWrittenAccountPeriodKey,
                lTypeOfClassKey,
                lTypeOfLimitBasisKey,
                lCurrencyKey,
                dROE,
                dLimit,
                dExcessOf,
                bFixedCession,
                dCessionPc,
                dMaxCessionAmount,
                dMaxAggregate,
                bClaimCooperation,
                dClaimCooperationTrigger,
                dCashLossTrigger,
                dClaimAdviceTrigger,
                dClaimNotificationTrigger,
                bClaimsFeesRecoverable,
                dTotalBrokerOrderPC,
                lAllRiskTypeOfDeductibleKey,
                lARDTypeOfApplicablePeriodKey,
                dAllRiskDeductible,
                dAllRiskMinDeductible,
                dAllRiskMaxDeductible,
                lPremiumRetainedPC,
                lStatementFrequencyKey,
                lStatementInterval,
                dPremRetainedInterestPC,
                lRISectionChainKey,
                lTypeOfInstalmentKey,
                nInterval,
                bOverideToSingle,
                lDueDateModifierKey,
                nFixedInstalmentNumber,
                bCustomInstalments,
                nTermsOfTradeDays,
                dtFirstInstalmentDueDate,
                bDisplayMD,
                bCashLoss,
                bUnlimitedReinstatements,
                nCountOfDisplayReinstatements,
                nHasPremium,
                bApplyLimitsToCessionPC,
                dTotalInstalmentsPC,
                bAllCoveragesIncluded,
                dLimit100,
                lTypeOfRIBasisKey,
                dEventLimit,
                dExcess,
                dDeductible,
                bFronting,
                lTypeofRIClassKey,
                lTypeofRILayerClassKey,
                lTypeofBasisIncomeKey,
                lTypeofPaymentDueKey,
                lOrigCcyOfRiensAggLimitKey,
                nNoOfRiens,
                dRiensAggLimit,
                lBaseOfRiensKey,
                lFrontingKey,
                lPremiumRetainedOffShorePC,
                lPremiumRetainedOnShorePC,
                lPremiumRetainedMarinePC,
                lMarketLeaderKey,
                ltypeofPremiumPaymentWarrantyKey,
                dTotalTreatyPropPc,
                bFacFollowInwardInstalment
            order by
                dw_loadts
        ) as dw_extract_order
    from
        ri_section
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lRISectionKey,
        lRIActivityKey,
        lRIPolicyKey,
        lRIFolderKey,
        sReference,
        nVersion,
        dtPeriodFrom,
        dtPeriodTo,
        bAutoProfiling,
        lWrittenAccountPeriodKey,
        lTypeOfClassKey,
        lTypeOfLimitBasisKey,
        lCurrencyKey,
        dROE,
        dLimit,
        dExcessOf,
        bFixedCession,
        dCessionPc,
        dMaxCessionAmount,
        dMaxAggregate,
        bClaimCooperation,
        dClaimCooperationTrigger,
        dCashLossTrigger,
        dClaimAdviceTrigger,
        dClaimNotificationTrigger,
        bClaimsFeesRecoverable,
        dTotalBrokerOrderPC,
        lAllRiskTypeOfDeductibleKey,
        lARDTypeOfApplicablePeriodKey,
        dAllRiskDeductible,
        dAllRiskMinDeductible,
        dAllRiskMaxDeductible,
        lPremiumRetainedPC,
        lStatementFrequencyKey,
        lStatementInterval,
        dPremRetainedInterestPC,
        lRISectionChainKey,
        lTypeOfInstalmentKey,
        nInterval,
        bOverideToSingle,
        lDueDateModifierKey,
        nFixedInstalmentNumber,
        bCustomInstalments,
        nTermsOfTradeDays,
        dtFirstInstalmentDueDate,
        bDisplayMD,
        bCashLoss,
        bUnlimitedReinstatements,
        nCountOfDisplayReinstatements,
        nHasPremium,
        bApplyLimitsToCessionPC,
        dTotalInstalmentsPC,
        bAllCoveragesIncluded,
        dLimit100,
        lTypeOfRIBasisKey,
        dEventLimit,
        dExcess,
        dDeductible,
        bFronting,
        lTypeofRIClassKey,
        lTypeofRILayerClassKey,
        lTypeofBasisIncomeKey,
        lTypeofPaymentDueKey,
        lOrigCcyOfRiensAggLimitKey,
        nNoOfRiens,
        dRiensAggLimit,
        lBaseOfRiensKey,
        lFrontingKey,
        lPremiumRetainedOffShorePC,
        lPremiumRetainedOnShorePC,
        lPremiumRetainedMarinePC,
        lMarketLeaderKey,
        ltypeofPremiumPaymentWarrantyKey,
        dTotalTreatyPropPc,
        bFacFollowInwardInstalment,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lRISectionKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged
