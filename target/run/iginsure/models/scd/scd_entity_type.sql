create view "dbt_dev"."scd_entity_type__dbt_tmp" as
    -- This file is automatically generated

with

entity_type as (
    select * from "IGI_PROD_DW"."dbo"."ENTITY"
),

ordered as (
    select
        LENTITYKEY,
        SENTITY,
        SENTITYPLURAL,
        SENTITYSHORT,
        SENTITYPLURALSHORT,
        STABLE,
        LICONKEY,
        LENTITYFAMILYKEY,
        LENTITYSTATEKEY,
        LSTATEHOLDINGENTITYKEY,
        LSENTITYRELATIONSHIPKEY,
        BVERSIONINGENTITY,
        BISVERSIONED,
        LVERSIONENTITYKEY,
        LVENTITYRELATIONSHIPKEY,
        BOPENDIRECT,
        BVOLUMINOUS,
        BINDEX,
        BCOPYABLE,
        BBASE,
        BCANENQUIRE,
        BMULTIPLEENTITY,
        SNOTE,
        LCREATETASKLISTKEY,
        LEDITTASKLISTKEY,
        LDELETETASKLISTKEY,
        BLINKENTITY,
        LTYPEOFLINKENTITYKEY,
        LINVERSELINKENTITYPROPERTYKEY,
        NDBSOURCE,
        NSTATEHOLDING,
        BNEWDIRECT,
        NENTITYTYPE,
        LLANGLOOKUPENTITYKEY,
        NIPTYPE,
        LIPCONTROLENTITYKEY,
        lDefaultOpenEnquiryKey,
        lAliasLookupEntityKey,
        lTypeOfIndexGroupKey,
        bAllowFileAttachments,
        MetadataIdentifier,
        BDEFAULTENQUIRY,
        dw_loadts,
        row_number() over (
            partition by
                LENTITYKEY,
                SENTITY,
                SENTITYPLURAL,
                SENTITYSHORT,
                SENTITYPLURALSHORT,
                STABLE,
                LICONKEY,
                LENTITYFAMILYKEY,
                LENTITYSTATEKEY,
                LSTATEHOLDINGENTITYKEY,
                LSENTITYRELATIONSHIPKEY,
                BVERSIONINGENTITY,
                BISVERSIONED,
                LVERSIONENTITYKEY,
                LVENTITYRELATIONSHIPKEY,
                BOPENDIRECT,
                BVOLUMINOUS,
                BINDEX,
                BCOPYABLE,
                BBASE,
                BCANENQUIRE,
                BMULTIPLEENTITY,
                SNOTE,
                LCREATETASKLISTKEY,
                LEDITTASKLISTKEY,
                LDELETETASKLISTKEY,
                BLINKENTITY,
                LTYPEOFLINKENTITYKEY,
                LINVERSELINKENTITYPROPERTYKEY,
                NDBSOURCE,
                NSTATEHOLDING,
                BNEWDIRECT,
                NENTITYTYPE,
                LLANGLOOKUPENTITYKEY,
                NIPTYPE,
                LIPCONTROLENTITYKEY,
                lDefaultOpenEnquiryKey,
                lAliasLookupEntityKey,
                lTypeOfIndexGroupKey,
                bAllowFileAttachments,
                MetadataIdentifier,
                BDEFAULTENQUIRY
            order by
                dw_loadts
        ) as dw_extract_order
    from
        entity_type
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        LENTITYKEY,
        SENTITY,
        SENTITYPLURAL,
        SENTITYSHORT,
        SENTITYPLURALSHORT,
        STABLE,
        LICONKEY,
        LENTITYFAMILYKEY,
        LENTITYSTATEKEY,
        LSTATEHOLDINGENTITYKEY,
        LSENTITYRELATIONSHIPKEY,
        BVERSIONINGENTITY,
        BISVERSIONED,
        LVERSIONENTITYKEY,
        LVENTITYRELATIONSHIPKEY,
        BOPENDIRECT,
        BVOLUMINOUS,
        BINDEX,
        BCOPYABLE,
        BBASE,
        BCANENQUIRE,
        BMULTIPLEENTITY,
        SNOTE,
        LCREATETASKLISTKEY,
        LEDITTASKLISTKEY,
        LDELETETASKLISTKEY,
        BLINKENTITY,
        LTYPEOFLINKENTITYKEY,
        LINVERSELINKENTITYPROPERTYKEY,
        NDBSOURCE,
        NSTATEHOLDING,
        BNEWDIRECT,
        NENTITYTYPE,
        LLANGLOOKUPENTITYKEY,
        NIPTYPE,
        LIPCONTROLENTITYKEY,
        lDefaultOpenEnquiryKey,
        lAliasLookupEntityKey,
        lTypeOfIndexGroupKey,
        bAllowFileAttachments,
        MetadataIdentifier,
        BDEFAULTENQUIRY,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by LENTITYKEY order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged
