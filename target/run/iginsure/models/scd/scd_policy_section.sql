create view "dbt_dev"."scd_policy_section__dbt_tmp" as
    -- This file is automatically generated


with

policy_section as (
    select * from "IGI_PROD_DW"."dbo"."PolicySection"
),

ordered as (
    select
        lPolicySectionKey,
        lPolicyActivityKey,
        lPolicyKey,
        lPolicyFolderKey,
        nSequence,
        lAuthorityCheckJoinKey,
        lPolicySectionChainKey,
        bNewSectionThisActivity,
        bNewSectionThisEndorsement,
        bProductPriming,
        lProductTemplateSectionKey,
        lAgreementSectionKey,
        lTypeOfSatelliteTableKey,
        lTypeOfPolicySectionScreenKey,
        sSectionReference,
        sUniqueMarketReference,
        sOpenXposureLinkReference,
        lCreatedByContactKey,
        dtCreated,
        lTypeOfLayerKey,
        b100PcRisk,
        bPrimaryLayer,
        lTypeOfClassKey,
        sClass,
        lTypeOfPlacementKey,
        bSingleMarket,
        dtPeriodFrom,
        dtPeriodTo,
        dtPeriodToDisplay,
        nPeriodDays,
        bMidnightStartTime,
        dtCancel,
        lPolicySectionCurrencyKey,
        dROE,
        dWorkingLinePc,
        dActualEstimatedLinePc,
        dActualSignedLinePc,
        sBrokerReference,
        lTypeOfLimitBasisKey,
        lLimTypeOfApplicablePeriodKey,
        dMasterLimit,
        dLimit,
        dLimitShareT,
        dExcessOf,
        dLimitAggregate,
        bSingleAggregate,
        dTIV,
        dCatPc,
        dUnderlyingLimitOccurrence,
        dUnderlyingLimitAggregate,
        dSelfInsuredRetentionOccurrenc,
        dSelfInsuredRetentionAggregate,
        dSelfInsuredRetentionDeductibl,
        lTypeOfDefenseLimitsKey,
        lTypeOfExposureCalculationKey,
        dExposure100,
        dExposureT,
        lAllRiskTypeOfDeductibleKey,
        lARDTypeOfApplicablePeriodKey,
        dAllRiskDeductible,
        dAllRiskMinDeductible,
        dAllRiskMaxDeductible,
        dAllRiskDeductibleAggregate,
        lTypeOfDeductionProcessingKey,
        dDeductionsPc,
        lTypeOfProductRatingKey,
        lTypeOfPremiumEntryKey,
        dTotalPremiumSplitPc,
        dGrossPremium100,
        dApportionRatedPremium100,
        lTypeOfPaymentTermKey,
        lTypeOfTaxEntryKey,
        lTypeOfTaxRatingElementKey,
        dTaxRatingAmount,
        dTaxScheduleSplitAmountTotal,
        dTaxScheduleSplitPcTotal,
        dTaxScheduleSplitPremiumTotal,
        dTaxScheduleInsuredTotal,
        dTaxScheduleInsurerTotal,
        dTaxInsuredRate,
        dTaxInsurerRate,
        dEnterInsuredTax,
        dEnterInsurerTax,
        dWorkingInsuredTax,
        dWorkingInsurerTax,
        nNonCriticalSubjectivityDays,
        nEndorsementNumberCounter,
        bStatCodeManual,
        lProductTypeOfLayerKey,
        lTypeOfLimitCaptureKey,
        bRated,
        dRateOnLine,
        lTerritorykey,
        lBrokerContactKey,
        bMasterSection,
        lInsuredContactKey,
        bUnlimitedReinstatements,
        bReinstatementsApplicable,
        nNoOfReinstatements,
        nAvailableReinstatements,
        bProrata,
        dReinstatementPc,
        dTotalEPI100,
        dTaxExemptpc,
        dTaxExemptAmount,
        bClonedPolicyFolder,
        bMandatory,
        lLocationAddressKey,
        sLocationAddress1,
        sLocationAddress2,
        sLocationAddressCity,
        SLocationAddressPostCode,
        lLocationAddressCityKey,
        lLocationAddressStateKey,
        lLocationAddressCountryKey,
        lLocationAddressPostCodeKey,
        dLocationLatitude,
        dLocationLongitude,
        lLocationAddressCountyKey,
        bEUMember,
        sRiskNarrative,
        sMPLNotes,
        lEffectiveDateHour,
        lEffectiveDateMinute,
        bPeriodTBA,
        dtQuoteOpenUntil,
        bPrimaryLocation,
        bLocAddressCountryHasStates,
        bLocAddressStateRequiredOnAddr,
        bMakePrimaryLocation,
        lTypeOfRateModifierBasisKey,
        dRatingModifier,
        lTypeOfAddressEntryKey,
        lMasterPolicySectionChainKey,
        nProductOrder,
        lTypeOfPolicySectionKey,
        lLocationAddressZipCityKey,
        lLocationAddressZipStateKey,
        lLocationAddressCityStateKey,
        dLimitInBaseCcy,
        dTotalCommissionPC,
        dMaximumCommissionPc,
        bPreventPolicyDeductionRecalc,
        lMultiLineYNkey,
        nLinesPerSection,
        sLocationCountryText,
        sLocationCityText,
        sConveyanceNotes,
        sGeoGraphicalLimitsNotes,
        dAgreementSectionPML,
        bAgreementPMLChecks,
        dAgreementSectionROE,
        LAgreementSectionCCYKey,
        lOverrideAgreementClassKey,
        lJurisdictionCountrykey,
        lJurisdictionStatekey,
        lScheduleCountry,
        lScheduleState,
        bCreatedBySchedule,
        lAgreementSettCcyKey,
        dtFirstInstalmentDueDate,
        nFixedInstalmentNumber,
        bCustomInstalments,
        lDueDateModifierKey,
        nInterval,
        nTermsOfTradeDays,
        lTypeOfInstalmentKey,
        bOverideToSingle,
        lPolicySectionDefaultAddKey,
        bLocationBasedSection,
        sLocationFullAddress,
        bOnAgreement,
        lEarningPatternKey,
        lWritingPatternKey,
        lEditScreenKey,
        lViewSingleLineScreenKey,
        lViewMultiLineScreenKey,
        sAdditionalCoverNotes,
        dTotalInstalmentsPC,
        bAgreementOverrideComplete,
        dMaxAgreementOccurrenceLimit,
        dMaxAgreementAggregateLimit,
        dGrossPremiumTotalSharePrev,
        dLimitShareTechnicalPrevious,
        lAgreementSectionChainKey,
        bLimitWithinAgreement,
        bPremiumWithinAgreement,
        bSectionExpired,
        bSectionAgreementAccumulated,
        dGrossPremiumTotalShare,
        dAgreementPremiumIncomeLimit,
        dPreviousEndorsementLimit,
        dLimitShareTBound,
        dGrossPremiumShareBound,
        bLocationCountryIsMandatory,
        bLocationAddressIsMandatory,
        nCodeSplitNotDone,
        dCessionPC,
        dCashCallLimit,
        nNoLines,
        dMaxCapacity,
        bPremiumReserveRetained,
        bLossReserveRetained,
        dAttritionalLossRatioPC,
        dLargeLossRatioPC,
        dCatLoadingPC,
        dProjectedLossRatioPC,
        dEstimatedProfitCommissionPC,
        dCombinedRatioPC,
        dPortfolioPremiumInPC,
        dPortfolioPremiumIn,
        dPortfolioLossInPC,
        lNumberOfSlidesKey,
        lTypeOfPremiumBaseKey,
        dPremiumCommission,
        dtFirstAdjustment,
        lTypeOfAdjustmentFrequencyKey,
        dtFinalAdjustment,
        dCedingCommissionPC,
        dProfitCommissionPc,
        dManagementExpensesPC,
        dOtherDeductionsPC,
        dProfitPC,
        nNumberClauses,
        bSetAutoPolicyDeductions,
        nNoInvalidAgreementPML,
        bInitialiseAutoDeductions,
        bShowROE,
        bRatingBasisVisible,
        bDisplayMD,
        bCoverageElementsRated,
        lMasterPolicySectionKey,
        bBinderPolicy,
        bAutoAdd,
        lImplementationSetupForNewOldRIKey,
        bEnableNewRI,
        bEnterTaxScheduleCountryPc,
        bIsAIHidden,
        bUnattached,
        lOSFICodeKey,
        nTotalBinderProportionPc,
        lTypeOfDeductibleBasisKey,
        n1stInstTermsOfTradeDays,
        dEventLimit100,
        dMaxPMLLimitShare,
        dMaxEventLimitShare,
        ltypeofPremiumPaymentWarrantyKey,
        lClassificationKey,
        lSubClassKey,
        lSolvencyIIKey,
        lEndorementSubClassificationKey,
        dLimitOrig,
        sPolicySectionBKReference,
        nCountAgencyFees,
        nSubdivision,
        bUseLimitROE,
        lporductkey,
        bAgnecyFeesOverrideTrigger,
        bConfrimInstallment,
        dEventLimit100USD,
        dEventLimitShareUSD,
        dEventLimitShareOrig,
        dPMLShareOrig,
        bProductLimitCheck,
        bProductLimitOverride,
        dw_loadts,
        row_number() over (
            partition by
                lPolicySectionKey,
                lPolicyActivityKey,
                lPolicyKey,
                lPolicyFolderKey,
                nSequence,
                lAuthorityCheckJoinKey,
                lPolicySectionChainKey,
                bNewSectionThisActivity,
                bNewSectionThisEndorsement,
                bProductPriming,
                lProductTemplateSectionKey,
                lAgreementSectionKey,
                lTypeOfSatelliteTableKey,
                lTypeOfPolicySectionScreenKey,
                sSectionReference,
                sUniqueMarketReference,
                sOpenXposureLinkReference,
                lCreatedByContactKey,
                dtCreated,
                lTypeOfLayerKey,
                b100PcRisk,
                bPrimaryLayer,
                lTypeOfClassKey,
                sClass,
                lTypeOfPlacementKey,
                bSingleMarket,
                dtPeriodFrom,
                dtPeriodTo,
                dtPeriodToDisplay,
                nPeriodDays,
                bMidnightStartTime,
                dtCancel,
                lPolicySectionCurrencyKey,
                dROE,
                dWorkingLinePc,
                dActualEstimatedLinePc,
                dActualSignedLinePc,
                sBrokerReference,
                lTypeOfLimitBasisKey,
                lLimTypeOfApplicablePeriodKey,
                dMasterLimit,
                dLimit,
                dLimitShareT,
                dExcessOf,
                dLimitAggregate,
                bSingleAggregate,
                dTIV,
                dCatPc,
                dUnderlyingLimitOccurrence,
                dUnderlyingLimitAggregate,
                dSelfInsuredRetentionOccurrenc,
                dSelfInsuredRetentionAggregate,
                dSelfInsuredRetentionDeductibl,
                lTypeOfDefenseLimitsKey,
                lTypeOfExposureCalculationKey,
                dExposure100,
                dExposureT,
                lAllRiskTypeOfDeductibleKey,
                lARDTypeOfApplicablePeriodKey,
                dAllRiskDeductible,
                dAllRiskMinDeductible,
                dAllRiskMaxDeductible,
                dAllRiskDeductibleAggregate,
                lTypeOfDeductionProcessingKey,
                dDeductionsPc,
                lTypeOfProductRatingKey,
                lTypeOfPremiumEntryKey,
                dTotalPremiumSplitPc,
                dGrossPremium100,
                dApportionRatedPremium100,
                lTypeOfPaymentTermKey,
                lTypeOfTaxEntryKey,
                lTypeOfTaxRatingElementKey,
                dTaxRatingAmount,
                dTaxScheduleSplitAmountTotal,
                dTaxScheduleSplitPcTotal,
                dTaxScheduleSplitPremiumTotal,
                dTaxScheduleInsuredTotal,
                dTaxScheduleInsurerTotal,
                dTaxInsuredRate,
                dTaxInsurerRate,
                dEnterInsuredTax,
                dEnterInsurerTax,
                dWorkingInsuredTax,
                dWorkingInsurerTax,
                nNonCriticalSubjectivityDays,
                nEndorsementNumberCounter,
                bStatCodeManual,
                lProductTypeOfLayerKey,
                lTypeOfLimitCaptureKey,
                bRated,
                dRateOnLine,
                lTerritorykey,
                lBrokerContactKey,
                bMasterSection,
                lInsuredContactKey,
                bUnlimitedReinstatements,
                bReinstatementsApplicable,
                nNoOfReinstatements,
                nAvailableReinstatements,
                bProrata,
                dReinstatementPc,
                dTotalEPI100,
                dTaxExemptpc,
                dTaxExemptAmount,
                bClonedPolicyFolder,
                bMandatory,
                lLocationAddressKey,
                sLocationAddress1,
                sLocationAddress2,
                sLocationAddressCity,
                SLocationAddressPostCode,
                lLocationAddressCityKey,
                lLocationAddressStateKey,
                lLocationAddressCountryKey,
                lLocationAddressPostCodeKey,
                dLocationLatitude,
                dLocationLongitude,
                lLocationAddressCountyKey,
                bEUMember,
                sRiskNarrative,
                sMPLNotes,
                lEffectiveDateHour,
                lEffectiveDateMinute,
                bPeriodTBA,
                dtQuoteOpenUntil,
                bPrimaryLocation,
                bLocAddressCountryHasStates,
                bLocAddressStateRequiredOnAddr,
                bMakePrimaryLocation,
                lTypeOfRateModifierBasisKey,
                dRatingModifier,
                lTypeOfAddressEntryKey,
                lMasterPolicySectionChainKey,
                nProductOrder,
                lTypeOfPolicySectionKey,
                lLocationAddressZipCityKey,
                lLocationAddressZipStateKey,
                lLocationAddressCityStateKey,
                dLimitInBaseCcy,
                dTotalCommissionPC,
                dMaximumCommissionPc,
                bPreventPolicyDeductionRecalc,
                lMultiLineYNkey,
                nLinesPerSection,
                sLocationCountryText,
                sLocationCityText,
                sConveyanceNotes,
                sGeoGraphicalLimitsNotes,
                dAgreementSectionPML,
                bAgreementPMLChecks,
                dAgreementSectionROE,
                LAgreementSectionCCYKey,
                lOverrideAgreementClassKey,
                lJurisdictionCountrykey,
                lJurisdictionStatekey,
                lScheduleCountry,
                lScheduleState,
                bCreatedBySchedule,
                lAgreementSettCcyKey,
                dtFirstInstalmentDueDate,
                nFixedInstalmentNumber,
                bCustomInstalments,
                lDueDateModifierKey,
                nInterval,
                nTermsOfTradeDays,
                lTypeOfInstalmentKey,
                bOverideToSingle,
                lPolicySectionDefaultAddKey,
                bLocationBasedSection,
                sLocationFullAddress,
                bOnAgreement,
                lEarningPatternKey,
                lWritingPatternKey,
                lEditScreenKey,
                lViewSingleLineScreenKey,
                lViewMultiLineScreenKey,
                sAdditionalCoverNotes,
                dTotalInstalmentsPC,
                bAgreementOverrideComplete,
                dMaxAgreementOccurrenceLimit,
                dMaxAgreementAggregateLimit,
                dGrossPremiumTotalSharePrev,
                dLimitShareTechnicalPrevious,
                lAgreementSectionChainKey,
                bLimitWithinAgreement,
                bPremiumWithinAgreement,
                bSectionExpired,
                bSectionAgreementAccumulated,
                dGrossPremiumTotalShare,
                dAgreementPremiumIncomeLimit,
                dPreviousEndorsementLimit,
                dLimitShareTBound,
                dGrossPremiumShareBound,
                bLocationCountryIsMandatory,
                bLocationAddressIsMandatory,
                nCodeSplitNotDone,
                dCessionPC,
                dCashCallLimit,
                nNoLines,
                dMaxCapacity,
                bPremiumReserveRetained,
                bLossReserveRetained,
                dAttritionalLossRatioPC,
                dLargeLossRatioPC,
                dCatLoadingPC,
                dProjectedLossRatioPC,
                dEstimatedProfitCommissionPC,
                dCombinedRatioPC,
                dPortfolioPremiumInPC,
                dPortfolioPremiumIn,
                dPortfolioLossInPC,
                lNumberOfSlidesKey,
                lTypeOfPremiumBaseKey,
                dPremiumCommission,
                dtFirstAdjustment,
                lTypeOfAdjustmentFrequencyKey,
                dtFinalAdjustment,
                dCedingCommissionPC,
                dProfitCommissionPc,
                dManagementExpensesPC,
                dOtherDeductionsPC,
                dProfitPC,
                nNumberClauses,
                bSetAutoPolicyDeductions,
                nNoInvalidAgreementPML,
                bInitialiseAutoDeductions,
                bShowROE,
                bRatingBasisVisible,
                bDisplayMD,
                bCoverageElementsRated,
                lMasterPolicySectionKey,
                bBinderPolicy,
                bAutoAdd,
                lImplementationSetupForNewOldRIKey,
                bEnableNewRI,
                bEnterTaxScheduleCountryPc,
                bIsAIHidden,
                bUnattached,
                lOSFICodeKey,
                nTotalBinderProportionPc,
                lTypeOfDeductibleBasisKey,
                n1stInstTermsOfTradeDays,
                dEventLimit100,
                dMaxPMLLimitShare,
                dMaxEventLimitShare,
                ltypeofPremiumPaymentWarrantyKey,
                lClassificationKey,
                lSubClassKey,
                lSolvencyIIKey,
                lEndorementSubClassificationKey,
                dLimitOrig,
                sPolicySectionBKReference,
                nCountAgencyFees,
                nSubdivision,
                bUseLimitROE,
                lporductkey,
                bAgnecyFeesOverrideTrigger,
                bConfrimInstallment,
                dEventLimit100USD,
                dEventLimitShareUSD,
                dEventLimitShareOrig,
                dPMLShareOrig,
                bProductLimitCheck,
                bProductLimitOverride
            order by
                dw_loadts
        ) as dw_extract_order
    from
        policy_section
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lPolicySectionKey,
        lPolicyActivityKey,
        lPolicyKey,
        lPolicyFolderKey,
        nSequence,
        lAuthorityCheckJoinKey,
        lPolicySectionChainKey,
        bNewSectionThisActivity,
        bNewSectionThisEndorsement,
        bProductPriming,
        lProductTemplateSectionKey,
        lAgreementSectionKey,
        lTypeOfSatelliteTableKey,
        lTypeOfPolicySectionScreenKey,
        sSectionReference,
        sUniqueMarketReference,
        sOpenXposureLinkReference,
        lCreatedByContactKey,
        dtCreated,
        lTypeOfLayerKey,
        b100PcRisk,
        bPrimaryLayer,
        lTypeOfClassKey,
        sClass,
        lTypeOfPlacementKey,
        bSingleMarket,
        dtPeriodFrom,
        dtPeriodTo,
        dtPeriodToDisplay,
        nPeriodDays,
        bMidnightStartTime,
        dtCancel,
        lPolicySectionCurrencyKey,
        dROE,
        dWorkingLinePc,
        dActualEstimatedLinePc,
        dActualSignedLinePc,
        sBrokerReference,
        lTypeOfLimitBasisKey,
        lLimTypeOfApplicablePeriodKey,
        dMasterLimit,
        dLimit,
        dLimitShareT,
        dExcessOf,
        dLimitAggregate,
        bSingleAggregate,
        dTIV,
        dCatPc,
        dUnderlyingLimitOccurrence,
        dUnderlyingLimitAggregate,
        dSelfInsuredRetentionOccurrenc,
        dSelfInsuredRetentionAggregate,
        dSelfInsuredRetentionDeductibl,
        lTypeOfDefenseLimitsKey,
        lTypeOfExposureCalculationKey,
        dExposure100,
        dExposureT,
        lAllRiskTypeOfDeductibleKey,
        lARDTypeOfApplicablePeriodKey,
        dAllRiskDeductible,
        dAllRiskMinDeductible,
        dAllRiskMaxDeductible,
        dAllRiskDeductibleAggregate,
        lTypeOfDeductionProcessingKey,
        dDeductionsPc,
        lTypeOfProductRatingKey,
        lTypeOfPremiumEntryKey,
        dTotalPremiumSplitPc,
        dGrossPremium100,
        dApportionRatedPremium100,
        lTypeOfPaymentTermKey,
        lTypeOfTaxEntryKey,
        lTypeOfTaxRatingElementKey,
        dTaxRatingAmount,
        dTaxScheduleSplitAmountTotal,
        dTaxScheduleSplitPcTotal,
        dTaxScheduleSplitPremiumTotal,
        dTaxScheduleInsuredTotal,
        dTaxScheduleInsurerTotal,
        dTaxInsuredRate,
        dTaxInsurerRate,
        dEnterInsuredTax,
        dEnterInsurerTax,
        dWorkingInsuredTax,
        dWorkingInsurerTax,
        nNonCriticalSubjectivityDays,
        nEndorsementNumberCounter,
        bStatCodeManual,
        lProductTypeOfLayerKey,
        lTypeOfLimitCaptureKey,
        bRated,
        dRateOnLine,
        lTerritorykey,
        lBrokerContactKey,
        bMasterSection,
        lInsuredContactKey,
        bUnlimitedReinstatements,
        bReinstatementsApplicable,
        nNoOfReinstatements,
        nAvailableReinstatements,
        bProrata,
        dReinstatementPc,
        dTotalEPI100,
        dTaxExemptpc,
        dTaxExemptAmount,
        bClonedPolicyFolder,
        bMandatory,
        lLocationAddressKey,
        sLocationAddress1,
        sLocationAddress2,
        sLocationAddressCity,
        SLocationAddressPostCode,
        lLocationAddressCityKey,
        lLocationAddressStateKey,
        lLocationAddressCountryKey,
        lLocationAddressPostCodeKey,
        dLocationLatitude,
        dLocationLongitude,
        lLocationAddressCountyKey,
        bEUMember,
        sRiskNarrative,
        sMPLNotes,
        lEffectiveDateHour,
        lEffectiveDateMinute,
        bPeriodTBA,
        dtQuoteOpenUntil,
        bPrimaryLocation,
        bLocAddressCountryHasStates,
        bLocAddressStateRequiredOnAddr,
        bMakePrimaryLocation,
        lTypeOfRateModifierBasisKey,
        dRatingModifier,
        lTypeOfAddressEntryKey,
        lMasterPolicySectionChainKey,
        nProductOrder,
        lTypeOfPolicySectionKey,
        lLocationAddressZipCityKey,
        lLocationAddressZipStateKey,
        lLocationAddressCityStateKey,
        dLimitInBaseCcy,
        dTotalCommissionPC,
        dMaximumCommissionPc,
        bPreventPolicyDeductionRecalc,
        lMultiLineYNkey,
        nLinesPerSection,
        sLocationCountryText,
        sLocationCityText,
        sConveyanceNotes,
        sGeoGraphicalLimitsNotes,
        dAgreementSectionPML,
        bAgreementPMLChecks,
        dAgreementSectionROE,
        LAgreementSectionCCYKey,
        lOverrideAgreementClassKey,
        lJurisdictionCountrykey,
        lJurisdictionStatekey,
        lScheduleCountry,
        lScheduleState,
        bCreatedBySchedule,
        lAgreementSettCcyKey,
        dtFirstInstalmentDueDate,
        nFixedInstalmentNumber,
        bCustomInstalments,
        lDueDateModifierKey,
        nInterval,
        nTermsOfTradeDays,
        lTypeOfInstalmentKey,
        bOverideToSingle,
        lPolicySectionDefaultAddKey,
        bLocationBasedSection,
        sLocationFullAddress,
        bOnAgreement,
        lEarningPatternKey,
        lWritingPatternKey,
        lEditScreenKey,
        lViewSingleLineScreenKey,
        lViewMultiLineScreenKey,
        sAdditionalCoverNotes,
        dTotalInstalmentsPC,
        bAgreementOverrideComplete,
        dMaxAgreementOccurrenceLimit,
        dMaxAgreementAggregateLimit,
        dGrossPremiumTotalSharePrev,
        dLimitShareTechnicalPrevious,
        lAgreementSectionChainKey,
        bLimitWithinAgreement,
        bPremiumWithinAgreement,
        bSectionExpired,
        bSectionAgreementAccumulated,
        dGrossPremiumTotalShare,
        dAgreementPremiumIncomeLimit,
        dPreviousEndorsementLimit,
        dLimitShareTBound,
        dGrossPremiumShareBound,
        bLocationCountryIsMandatory,
        bLocationAddressIsMandatory,
        nCodeSplitNotDone,
        dCessionPC,
        dCashCallLimit,
        nNoLines,
        dMaxCapacity,
        bPremiumReserveRetained,
        bLossReserveRetained,
        dAttritionalLossRatioPC,
        dLargeLossRatioPC,
        dCatLoadingPC,
        dProjectedLossRatioPC,
        dEstimatedProfitCommissionPC,
        dCombinedRatioPC,
        dPortfolioPremiumInPC,
        dPortfolioPremiumIn,
        dPortfolioLossInPC,
        lNumberOfSlidesKey,
        lTypeOfPremiumBaseKey,
        dPremiumCommission,
        dtFirstAdjustment,
        lTypeOfAdjustmentFrequencyKey,
        dtFinalAdjustment,
        dCedingCommissionPC,
        dProfitCommissionPc,
        dManagementExpensesPC,
        dOtherDeductionsPC,
        dProfitPC,
        nNumberClauses,
        bSetAutoPolicyDeductions,
        nNoInvalidAgreementPML,
        bInitialiseAutoDeductions,
        bShowROE,
        bRatingBasisVisible,
        bDisplayMD,
        bCoverageElementsRated,
        lMasterPolicySectionKey,
        bBinderPolicy,
        bAutoAdd,
        lImplementationSetupForNewOldRIKey,
        bEnableNewRI,
        bEnterTaxScheduleCountryPc,
        bIsAIHidden,
        bUnattached,
        lOSFICodeKey,
        nTotalBinderProportionPc,
        lTypeOfDeductibleBasisKey,
        n1stInstTermsOfTradeDays,
        dEventLimit100,
        dMaxPMLLimitShare,
        dMaxEventLimitShare,
        ltypeofPremiumPaymentWarrantyKey,
        lClassificationKey,
        lSubClassKey,
        lSolvencyIIKey,
        lEndorementSubClassificationKey,
        dLimitOrig,
        sPolicySectionBKReference,
        nCountAgencyFees,
        nSubdivision,
        bUseLimitROE,
        lporductkey,
        bAgnecyFeesOverrideTrigger,
        bConfrimInstallment,
        dEventLimit100USD,
        dEventLimitShareUSD,
        dEventLimitShareOrig,
        dPMLShareOrig,
        bProductLimitCheck,
        bProductLimitOverride,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lPolicySectionKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged
