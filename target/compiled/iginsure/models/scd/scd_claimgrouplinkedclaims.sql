-- This file is automatically generated


with

claimgrouplinkedclaims as (
    select * from "IGI_PROD_DW"."dbo"."claimgrouplinkedclaims"
),

ordered as (
    select
        lClaimKey,
        lLinkedClaimKey,
        bUCRMatch,
        bDOLMatch,
        bPolicyMatch,
        lClaimGroupTypeKey,
        sClaimGroupType,
        dw_loadts,
        row_number() over (
            partition by
                lClaimKey,
                lLinkedClaimKey,
                bUCRMatch,
                bDOLMatch,
                bPolicyMatch,
                lClaimGroupTypeKey,
                sClaimGroupType,
                dw_loadts
            order by
                dw_loadts
        ) as dw_extract_order
    from
        claimgrouplinkedclaims
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
            lClaimKey,
            lLinkedClaimKey,
            bUCRMatch,
            bDOLMatch,
            bPolicyMatch,
            lClaimGroupTypeKey,
            sClaimGroupType,
            dw_loadts as _valid_from,
            lead(dw_loadts) over (partition by lClaimKey,lLinkedClaimKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged