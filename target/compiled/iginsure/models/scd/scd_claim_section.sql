-- This file is automatically generated

with

claim_section as (
    select * from "IGI_PROD_DW"."dbo"."ClaimSection"
),

ordered as (
    select
        lClaimSectionKey,
        lClaimKey,
        lAdditionalReserveCcyOrigKey,
        lAdditionalReserveCcyReportKey,
        lAdditionalReserveCcySettKey,
        lAgreementCurrencyKey,
        lAgreementSectionKey,
        lAgreementSectionLiabSumryKey,
        lAgrmntTypeOfRatingElementKey,
        lBordereauCurrencyKey,
        lBrokerContactKey,
        lClaimantContactKey,
        lClaimTypeOfClassKey,
        lClaimTypeOfRatingElementKey,
        lClaimTypeOfSubClassKey,
        lCurrentTypeOfReserveQualfKey,
        lEventKey,
        lExternalAdjusterContactKey,
        lExternalAttorneyContactKey,
        lExternalSurveyorContactKey,
        lInsuredContactKey,
        lInternalAdjusterContactKey,
        lInternalAttorneyContactKey,
        lLatestMovementKey,
        lPayCcyOrigKey,
        lPayCcyReportKey,
        lPayCcySettKey,
        lPolicyCurrencyKey,
        lPolicyLiabilityKey,
        lpolliabilityratingelementkey,
        lPolicySectionKey,
        lPolSectionLiabilitySummaryKey,
        lPolicyTypeOfClassKey,
        lPolicyTypeOfRatingElementKey,
        lPolicyTypeOfSubClassKey,
        lReserveCcyOrigKey,
        lReserveCcyReportKey,
        lReserveCcySettKey,
        lTransactionTypeKey,
        lTypeOfClaimAttachmentKey,
        lTypeOfLiabilityKey,
        lTypeOfMarketSourceKey,
        lTypeOfSectionKey,
        bReserveExceedsLimit,
        bReserveTBA,
        dAddReserveAuthorisedOrig100,
        dAddReserveAuthorisedOrigShare,
        dAddReserveAuthorisedSett100,
        dAddReserveAuthorisedSettShare,
        dAdditionalReserveOrig100,
        dAdditionalReserveOrigShare,
        dAdditionalReserveSett100,
        dAdditionalReserveSettShare,
        dAddReserveROEOrig,
        dAddReserveROEReport,
        dAddReserveROESett,
        dFacRIAddReserveSettShare,
        dFacRIPTDSettShare,
        dFacRIReserveSettShare,
        dCurrentIncurredOrig100,
        dCurrentIncurredOrigShare,
        dCurrentIncurredSett100,
        dCurrentIncurredSettShare,
        dInitialReserveSettShare,
        dLOCTotalDrawingsSettShare,
        dPTDAuthorisedBureauOrig100,
        dPTDAuthorisedBureauOrigShare,
        dPTDAuthorisedBureauSett100,
        dPTDAuthorisedBureauSettShare,
        dPTDAuthorisedManualOrig100,
        dPTDAuthorisedManualOrigShare,
        dPTDAuthorisedManualSett100,
        dPTDAuthorisedManualSettShare,
        dPTDAuthorisedOrig100,
        dPTDAuthorisedOrigShare,
        dPTDAuthorisedSett100,
        dPTDAuthorisedSettShare,
        dPTDBureauOrig100,
        dPTDBureauOrigShare,
        dPTDBureauSett100,
        dPTDBureauSettShare,
        dPTDManualOrig100,
        dPTDManualOrigShare,
        dPTDManualSett100,
        dPTDManualSettShare,
        dPaidToDateOrig100,
        dPaidToDateOrigShare,
        dPTDPendingBureauOrig100,
        dPTDPendingBureauOrigShare,
        dPTDPendingBureauSett100,
        dPTDPendingBureauSettShare,
        dPTDPendingManualOrig100,
        dPTDPendingManualOrigShare,
        dPTDPendingManualSett100,
        dPTDPendingManualSettShare,
        dPTDPendingOrig100,
        dPTDPendingOrigShare,
        dPTDPendingSett100,
        dPTDPendingSettShare,
        dPaidToDateSett100,
        dPaidToDateSettShare,
        dPayROEOrig,
        dPayROEReport,
        dPayROESett,
        dPolicyLimit,
        dPropRIAddReserveSettShare,
        dPropRIPTDSettShare,
        dPropRIReserveSettShare,
        dReserveAuthorisedOrig100,
        dReserveAuthorisedOrigShare,
        dReserveAuthorisedSett100,
        dReserveAuthorisedSettShare,
        dReserveOrig100,
        dReserveOrigShare,
        dReserveROEOrig,
        dReserveROEReport,
        dReserveROESett,
        dReserveSett100,
        dReserveSettShare,
        dtExternalAdjusterAssigned,
        dtExternalAttorneyAssigned,
        dtInternalAdjusterAssigned,
        dtInternalAttorneyAssigned,
        dTotalOSReserveMovements,
        dTotalReserveOrig100,
        dTotalReserveOrigShare,
        dTotalReserveSett100,
        dTotalReserveSettShare,
        dTotalRIRecoverySettShare,
        dTotalRIReserveSettShare,
        dXLRIAddReserveSettShare,
        dXLRIPTDSettShare,
        dXLRIReserveSettShare,
        nInvalidClassFlag,
        nMovementCount,
        sExternalAdjusterReference,
        sExternalLawyerReference,
        sExternalSurveyorReference,
        sSectionNotes,
        dIncurredBureauOrig100,
        dIncurredBureauOrigShare,
        dIncurredBureauSett100,
        dIncurredBureauSettShare,
        dIncurredManualOrig100,
        dIncurredManualOrigShare,
        dIncurredManualSett100,
        dIncurredManualSettShare,
        dWrittenLine,
        dSignedLine,
        dAggregateLimit,
        bProofOfLossPresented,
        dtProofOfLossPresented,
        dClaimPaymentLimit,
        bClaimWithinAgreement,
        dAgreementROE,
        nClaimSectionRegulatoryCount,
        nClaimSectionRegulatoryInCount,
        bBureauClaim,
        lMasterPolicySectionKey,
        bClaimWithinBinder,
        dBinderClaimPaymentLimit,
        lBinderCurrencyKey,
        dBinderROE,
        lReinstatementCurrencyKey,
        dReinstatementROE,
        dReinstatementTotalReserve,
        dReinstatementTotalPaidToDate,
        dReinstatementTotalDue,
        dReinstatementTotalReserveReport,
        dReinstatementTotalPaidToDateReport,
        dReinstatementTotalDueReport,
        lPolicyLineKey,
        dInitialReserveOrigShare,
        sClaimant,
        bInferredCCY,
        dw_loadts,
        row_number() over (
            partition by
                lClaimSectionKey,
                lClaimKey,
                lAdditionalReserveCcyOrigKey,
                lAdditionalReserveCcyReportKey,
                lAdditionalReserveCcySettKey,
                lAgreementCurrencyKey,
                lAgreementSectionKey,
                lAgreementSectionLiabSumryKey,
                lAgrmntTypeOfRatingElementKey,
                lBordereauCurrencyKey,
                lBrokerContactKey,
                lClaimantContactKey,
                lClaimTypeOfClassKey,
                lClaimTypeOfRatingElementKey,
                lClaimTypeOfSubClassKey,
                lCurrentTypeOfReserveQualfKey,
                lEventKey,
                lExternalAdjusterContactKey,
                lExternalAttorneyContactKey,
                lExternalSurveyorContactKey,
                lInsuredContactKey,
                lInternalAdjusterContactKey,
                lInternalAttorneyContactKey,
                lLatestMovementKey,
                lPayCcyOrigKey,
                lPayCcyReportKey,
                lPayCcySettKey,
                lPolicyCurrencyKey,
                lPolicyLiabilityKey,
                lpolliabilityratingelementkey,
                lPolicySectionKey,
                lPolSectionLiabilitySummaryKey,
                lPolicyTypeOfClassKey,
                lPolicyTypeOfRatingElementKey,
                lPolicyTypeOfSubClassKey,
                lReserveCcyOrigKey,
                lReserveCcyReportKey,
                lReserveCcySettKey,
                lTransactionTypeKey,
                lTypeOfClaimAttachmentKey,
                lTypeOfLiabilityKey,
                lTypeOfMarketSourceKey,
                lTypeOfSectionKey,
                bReserveExceedsLimit,
                bReserveTBA,
                dAddReserveAuthorisedOrig100,
                dAddReserveAuthorisedOrigShare,
                dAddReserveAuthorisedSett100,
                dAddReserveAuthorisedSettShare,
                dAdditionalReserveOrig100,
                dAdditionalReserveOrigShare,
                dAdditionalReserveSett100,
                dAdditionalReserveSettShare,
                dAddReserveROEOrig,
                dAddReserveROEReport,
                dAddReserveROESett,
                dFacRIAddReserveSettShare,
                dFacRIPTDSettShare,
                dFacRIReserveSettShare,
                dCurrentIncurredOrig100,
                dCurrentIncurredOrigShare,
                dCurrentIncurredSett100,
                dCurrentIncurredSettShare,
                dInitialReserveSettShare,
                dLOCTotalDrawingsSettShare,
                dPTDAuthorisedBureauOrig100,
                dPTDAuthorisedBureauOrigShare,
                dPTDAuthorisedBureauSett100,
                dPTDAuthorisedBureauSettShare,
                dPTDAuthorisedManualOrig100,
                dPTDAuthorisedManualOrigShare,
                dPTDAuthorisedManualSett100,
                dPTDAuthorisedManualSettShare,
                dPTDAuthorisedOrig100,
                dPTDAuthorisedOrigShare,
                dPTDAuthorisedSett100,
                dPTDAuthorisedSettShare,
                dPTDBureauOrig100,
                dPTDBureauOrigShare,
                dPTDBureauSett100,
                dPTDBureauSettShare,
                dPTDManualOrig100,
                dPTDManualOrigShare,
                dPTDManualSett100,
                dPTDManualSettShare,
                dPaidToDateOrig100,
                dPaidToDateOrigShare,
                dPTDPendingBureauOrig100,
                dPTDPendingBureauOrigShare,
                dPTDPendingBureauSett100,
                dPTDPendingBureauSettShare,
                dPTDPendingManualOrig100,
                dPTDPendingManualOrigShare,
                dPTDPendingManualSett100,
                dPTDPendingManualSettShare,
                dPTDPendingOrig100,
                dPTDPendingOrigShare,
                dPTDPendingSett100,
                dPTDPendingSettShare,
                dPaidToDateSett100,
                dPaidToDateSettShare,
                dPayROEOrig,
                dPayROEReport,
                dPayROESett,
                dPolicyLimit,
                dPropRIAddReserveSettShare,
                dPropRIPTDSettShare,
                dPropRIReserveSettShare,
                dReserveAuthorisedOrig100,
                dReserveAuthorisedOrigShare,
                dReserveAuthorisedSett100,
                dReserveAuthorisedSettShare,
                dReserveOrig100,
                dReserveOrigShare,
                dReserveROEOrig,
                dReserveROEReport,
                dReserveROESett,
                dReserveSett100,
                dReserveSettShare,
                dtExternalAdjusterAssigned,
                dtExternalAttorneyAssigned,
                dtInternalAdjusterAssigned,
                dtInternalAttorneyAssigned,
                dTotalOSReserveMovements,
                dTotalReserveOrig100,
                dTotalReserveOrigShare,
                dTotalReserveSett100,
                dTotalReserveSettShare,
                dTotalRIRecoverySettShare,
                dTotalRIReserveSettShare,
                dXLRIAddReserveSettShare,
                dXLRIPTDSettShare,
                dXLRIReserveSettShare,
                nInvalidClassFlag,
                nMovementCount,
                sExternalAdjusterReference,
                sExternalLawyerReference,
                sExternalSurveyorReference,
                sSectionNotes,
                dIncurredBureauOrig100,
                dIncurredBureauOrigShare,
                dIncurredBureauSett100,
                dIncurredBureauSettShare,
                dIncurredManualOrig100,
                dIncurredManualOrigShare,
                dIncurredManualSett100,
                dIncurredManualSettShare,
                dWrittenLine,
                dSignedLine,
                dAggregateLimit,
                bProofOfLossPresented,
                dtProofOfLossPresented,
                dClaimPaymentLimit,
                bClaimWithinAgreement,
                dAgreementROE,
                nClaimSectionRegulatoryCount,
                nClaimSectionRegulatoryInCount,
                bBureauClaim,
                lMasterPolicySectionKey,
                bClaimWithinBinder,
                dBinderClaimPaymentLimit,
                lBinderCurrencyKey,
                dBinderROE,
                lReinstatementCurrencyKey,
                dReinstatementROE,
                dReinstatementTotalReserve,
                dReinstatementTotalPaidToDate,
                dReinstatementTotalDue,
                dReinstatementTotalReserveReport,
                dReinstatementTotalPaidToDateReport,
                dReinstatementTotalDueReport,
                lPolicyLineKey,
                dInitialReserveOrigShare,
                sClaimant,
                bInferredCCY
            order by
                dw_loadts
        ) as dw_extract_order
    from
        claim_section
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lClaimSectionKey,
        lClaimKey,
        lAdditionalReserveCcyOrigKey,
        lAdditionalReserveCcyReportKey,
        lAdditionalReserveCcySettKey,
        lAgreementCurrencyKey,
        lAgreementSectionKey,
        lAgreementSectionLiabSumryKey,
        lAgrmntTypeOfRatingElementKey,
        lBordereauCurrencyKey,
        lBrokerContactKey,
        lClaimantContactKey,
        lClaimTypeOfClassKey,
        lClaimTypeOfRatingElementKey,
        lClaimTypeOfSubClassKey,
        lCurrentTypeOfReserveQualfKey,
        lEventKey,
        lExternalAdjusterContactKey,
        lExternalAttorneyContactKey,
        lExternalSurveyorContactKey,
        lInsuredContactKey,
        lInternalAdjusterContactKey,
        lInternalAttorneyContactKey,
        lLatestMovementKey,
        lPayCcyOrigKey,
        lPayCcyReportKey,
        lPayCcySettKey,
        lPolicyCurrencyKey,
        lPolicyLiabilityKey,
        lpolliabilityratingelementkey,
        lPolicySectionKey,
        lPolSectionLiabilitySummaryKey,
        lPolicyTypeOfClassKey,
        lPolicyTypeOfRatingElementKey,
        lPolicyTypeOfSubClassKey,
        lReserveCcyOrigKey,
        lReserveCcyReportKey,
        lReserveCcySettKey,
        lTransactionTypeKey,
        lTypeOfClaimAttachmentKey,
        lTypeOfLiabilityKey,
        lTypeOfMarketSourceKey,
        lTypeOfSectionKey,
        bReserveExceedsLimit,
        bReserveTBA,
        dAddReserveAuthorisedOrig100,
        dAddReserveAuthorisedOrigShare,
        dAddReserveAuthorisedSett100,
        dAddReserveAuthorisedSettShare,
        dAdditionalReserveOrig100,
        dAdditionalReserveOrigShare,
        dAdditionalReserveSett100,
        dAdditionalReserveSettShare,
        dAddReserveROEOrig,
        dAddReserveROEReport,
        dAddReserveROESett,
        dFacRIAddReserveSettShare,
        dFacRIPTDSettShare,
        dFacRIReserveSettShare,
        dCurrentIncurredOrig100,
        dCurrentIncurredOrigShare,
        dCurrentIncurredSett100,
        dCurrentIncurredSettShare,
        dInitialReserveSettShare,
        dLOCTotalDrawingsSettShare,
        dPTDAuthorisedBureauOrig100,
        dPTDAuthorisedBureauOrigShare,
        dPTDAuthorisedBureauSett100,
        dPTDAuthorisedBureauSettShare,
        dPTDAuthorisedManualOrig100,
        dPTDAuthorisedManualOrigShare,
        dPTDAuthorisedManualSett100,
        dPTDAuthorisedManualSettShare,
        dPTDAuthorisedOrig100,
        dPTDAuthorisedOrigShare,
        dPTDAuthorisedSett100,
        dPTDAuthorisedSettShare,
        dPTDBureauOrig100,
        dPTDBureauOrigShare,
        dPTDBureauSett100,
        dPTDBureauSettShare,
        dPTDManualOrig100,
        dPTDManualOrigShare,
        dPTDManualSett100,
        dPTDManualSettShare,
        dPaidToDateOrig100,
        dPaidToDateOrigShare,
        dPTDPendingBureauOrig100,
        dPTDPendingBureauOrigShare,
        dPTDPendingBureauSett100,
        dPTDPendingBureauSettShare,
        dPTDPendingManualOrig100,
        dPTDPendingManualOrigShare,
        dPTDPendingManualSett100,
        dPTDPendingManualSettShare,
        dPTDPendingOrig100,
        dPTDPendingOrigShare,
        dPTDPendingSett100,
        dPTDPendingSettShare,
        dPaidToDateSett100,
        dPaidToDateSettShare,
        dPayROEOrig,
        dPayROEReport,
        dPayROESett,
        dPolicyLimit,
        dPropRIAddReserveSettShare,
        dPropRIPTDSettShare,
        dPropRIReserveSettShare,
        dReserveAuthorisedOrig100,
        dReserveAuthorisedOrigShare,
        dReserveAuthorisedSett100,
        dReserveAuthorisedSettShare,
        dReserveOrig100,
        dReserveOrigShare,
        dReserveROEOrig,
        dReserveROEReport,
        dReserveROESett,
        dReserveSett100,
        dReserveSettShare,
        dtExternalAdjusterAssigned,
        dtExternalAttorneyAssigned,
        dtInternalAdjusterAssigned,
        dtInternalAttorneyAssigned,
        dTotalOSReserveMovements,
        dTotalReserveOrig100,
        dTotalReserveOrigShare,
        dTotalReserveSett100,
        dTotalReserveSettShare,
        dTotalRIRecoverySettShare,
        dTotalRIReserveSettShare,
        dXLRIAddReserveSettShare,
        dXLRIPTDSettShare,
        dXLRIReserveSettShare,
        nInvalidClassFlag,
        nMovementCount,
        sExternalAdjusterReference,
        sExternalLawyerReference,
        sExternalSurveyorReference,
        sSectionNotes,
        dIncurredBureauOrig100,
        dIncurredBureauOrigShare,
        dIncurredBureauSett100,
        dIncurredBureauSettShare,
        dIncurredManualOrig100,
        dIncurredManualOrigShare,
        dIncurredManualSett100,
        dIncurredManualSettShare,
        dWrittenLine,
        dSignedLine,
        dAggregateLimit,
        bProofOfLossPresented,
        dtProofOfLossPresented,
        dClaimPaymentLimit,
        bClaimWithinAgreement,
        dAgreementROE,
        nClaimSectionRegulatoryCount,
        nClaimSectionRegulatoryInCount,
        bBureauClaim,
        lMasterPolicySectionKey,
        bClaimWithinBinder,
        dBinderClaimPaymentLimit,
        lBinderCurrencyKey,
        dBinderROE,
        lReinstatementCurrencyKey,
        dReinstatementROE,
        dReinstatementTotalReserve,
        dReinstatementTotalPaidToDate,
        dReinstatementTotalDue,
        dReinstatementTotalReserveReport,
        dReinstatementTotalPaidToDateReport,
        dReinstatementTotalDueReport,
        lPolicyLineKey,
        dInitialReserveOrigShare,
        sClaimant,
        bInferredCCY,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lClaimSectionKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged