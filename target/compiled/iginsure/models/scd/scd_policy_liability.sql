-- This file is automatically generated


with

policy_liability as (
    select * from "IGI_PROD_DW"."dbo"."PolicyLiability"
),

ordered as (
    select
        lPolicyLiabilityKey,
        lPolicySectionKey,
        lPolicyActivityKey,
        lPolicyKey,
        lPolicyFolderKey,
        lPolicyLiabilityChainKey,
        lAuthorityCheckJoinKey,
        bProductPriming,
        lAgreementLiabilityKey,
        lProductTemplateLiabilityKey,
        bMandatory,
        bPrintOnDecSheet,
        nOrder,
        bMasterLimit,
        bGetsMasterLimit,
        bLimitLessThanParentLimit,
        bDefaultedMasterLimitEditable,
        bRatedPremiumIsProRated,
        nPeriodDays,
        lTypeOfSubClassKey,
        lTypeOfPlacementKey,
        lTypeOfLimitBasisKey,
        lTypeOfClaimBasisKey,
        dLimit,
        dExcessOf,
        dExposure,
        dLimitAggregate,
        lPLTypeOfDeductibleKey,
        dDeductible,
        lDeductibleRatingLookupKey,
        lDeductibleTemplateRatingKey,
        lLiabilityPremiumCcyKey,
        dLiabilityPremiumROE,
        dPremiumSplitPc,
        bPremiumApplicable,
        bRated,
        bPremiumAggregated,
        lTypeOfRateKey,
        dLookedUpRate,
        lTemplateRatingKey,
        lRatingLookupKey,
        lTypeOfRatingBasisKey,
        dRatingBasisAmount,
        dPreviousRatingBasisAmount,
        dVersionRatingBasisAmount,
        dRatingModifier,
        lTypeOfPremiumBasisKey,
        dMinimumDepositPc,
        dVersionDepositPremium100,
        dVersionAdjustmentPremium100,
        dVersionBasePremium100,
        dVersionGrossThisTime100,
        dVersionRatedPremium100,
        dVersionAdditionsThisTime100,
        dVersionDeductionsThisTime100,
        dVersionAdditionsPayaway100,
        dVersionDeductionsPayaway100,
        dVersDednsPassedToInsured100,
        dVersionBrokerDeductible100,
        dVersionNetToInsured100,
        dVersionCashReceivable100,
        dVersionNetThisTime100,
        dVersionDeductionsThisTimeShareTT,
        dVersnDeductionsPayawayShareW,
        dVersionNetThisTimeShareTT,
        dVersionAdjustmentPremiumS,
        dVersionAdditionsPayawayShareS,
        dVerDednsPassedToInsuredShareS,
        dVersionBasePremiumShareTT,
        dVersionRatedPremiumShareTT,
        dVersionDepositPremiumShareTT,
        dVersionGrossThisTimeShareTT,
        dVersionAdditionsThisTimeShareTT,
        dVersionBrokerDeductibleShareT,
        dVersionNetToInsuredShareT,
        dVersionCashReceivableShareT,
        dPreviousDepositPremium100,
        dPreviousBasePremium100,
        dPreviousGrossThisTime100,
        dPreviousRatedPremium100,
        dPreviousAdditionsThisTime100,
        dPreviousDeductionsThisTime100,
        dPreviousNetThisTime100,
        dTotalDepositPremium100,
        dTotalBasePremium100,
        dTotalRatedPremium100,
        dTotalGrossThisTime100,
        dTotalAdditionsThisTime100,
        dTotalDeductionsThisTime100,
        dTotalNetThisTime100,
        dTotalDeductionsThisTimeShareTT,
        dTotalNetThisTimeShareTT,
        dTotalRatedPremiumShareTT,
        dTotalAdditionsThisTimeShareTT,
        dTotalBasePremiumShareTT,
        dTotalGrossThisTimeShareTT,
        lEPICurrencyKey,
        dEPIROE,
        dVersionGrossGrossWritten100,
        dVersionGrossGrossWrittenShareTT,
        dVersionDeductionsWritten100,
        dVersionDeductionsWrittenShareTT,
        dVersionNetWritten100,
        dVersionNetWrittenShareTT,
        lPLRiskSettlementCurrency,
        dPLRiskSettROE,
        dCurrentInstalmentTotal100,
        bBurningCosts,
        dLowerBurningCostRate,
        dUpperBurningCostRate,
        lTypeOfRateModifierBasisKey,
        nPolicyTermFullMonths,
        nPolicyTermPartMonths,
        nPolicyTermRemainingDays,
        bSponsored,
        lTerritoryKey,
        dMinimumPC,
        dVersionMinimumPremium100,
        dVersionMinimumPremiumShareTT,
        dPreviousMinimumPremium100,
        dTotalMinimumPremium100,
        dTotalMinimumPremiumShareTT,
        dVersionGrossGrossThisTime100,
        dVersionGrossGrossThisTimeShareTT,
        lProductTemplateSectionKey,
        dPreviousGrossGrossWritten100,
        dTotalGrossGrossWritten100,
        dTotalGrossGrossWrittenShareTT,
        dRate,
        dTotalDepositPremiumShareTT,
        dVersionRatedPremium100Save,
        dVersionGrossPremium100Save,
        dEPI100Save,
        bInheritDeductible,
        boverridable,
        dVersnGrossGrossPremium100Save,
        dLookedUpMasterRate,
        lMasterPolicyLiabilityKey,
        lPolicyLiabilityMasterRateKey,
        lMastPolLiabilityChainKey,
        lMasterTemplateRatingKey,
        lLimitCurrencyKey,
        dLimitCurrencyROE,
        lAreaKey,
        bBasePremiumAggregated,
        dtTransitFrom,
        dtTransitTo,
        nTransitDays,
        dLimitInBaseCcy,
        bDefaultRatingBasisAmtToLimit,
        sCoverage,
        sCoverageCode,
        dPreviousGrossGrossThisTime100,
        dTotalGrossGrossThisTime100,
        dTotalGrossGrossThisTimeShareTT,
        dPreviousAdditionsWritten100,
        dTotalAdditionsWritten100,
        dVersionAdditionsWritten100,
        dVersionAdditionsWrittenShareTT,
        dPreviousDeductionsWritten100,
        dTotalDeductionsWritten100,
        dTotalDeductionsWrittenShareTT,
        dPreviousNetWritten100,
        dTotalNetWritten100,
        dVersionGrossWritten100,
        dVersionGrossWrittenShareTT,
        dTotalGrossWritten100,
        dPreviousGrossWritten100,
        dTotalGrossWrittenShareTT,
        dTotalAdditionsWrittenShareTT,
        dTotalNetWrittenShareTT,
        bExcludeTaxDeduction,
        dAgreementLimit,
        dAgreementAggregateLimit,
        dVersionNetPremToInsurerShareTT,
        dVersionNetPremToInsurer100,
        dVersionWNetPremToInsurerShareTT,
        dVersionWNetPremToInsurer100,
        dRatedPremiumOverride,
        dActualRatedPremium100,
        bNewCoverage,
        bBinderCurrencyRestriction,
        lLimitAIOr100Key,
        dCoverageAmountPc,
        lCoveragePcOfSubClassKey,
        lTypeOfCoverageGreaterLessThanKey,
        lCoverageGreaterLessThanOperatorKey,
        dCoverageDailyAmount,
        nCoverageDays,
        nCoverageWaitingPeriodDays,
        dCoverageWaitingPeriodAmount,
        lExcessCurrencyKey,
        lExcessAIOr100Key,
        dExcessROE,
        bAsScheduledLimitOccurence,
        bAsScheduledExcessOf,
        bAsScheduledLimitAggregate,
        bAsScheduledDailyAmount,
        bAsScheduledNoOfDays,
        bAsScheduledWaitingPeriodDays,
        lTypeofDeductibleBasedOnKey,
        lDeductibleCcyKey,
        lDedductibleAIor100Key,
        dDeductiblePC,
        dMinDeductible,
        dMaxDeductible,
        bAsScheduledDeductible,
        bAsScheduledDeductiblePC,
        bAsScheduledDeductibleMin,
        bAsScheduledDeductibleMax,
        bAsScheduleWaitingPeriodAmount,
        lCoverageSetKey,
        bIsAIHidden,
        lTypeOfCoverageOptionKey,
        dOccurrenceCompareAmount,
        dPMLPC,
        lTypeOfCoverageComparisonKey,
        dCessionPc,
        bAsScheduledPMLPc,
        lPMLOption,
        lExcessOption,
        sCoverageNarrative,
        dGrossForPeriod,
        dGrossForPeriodSave,
        dReplaceGrossForPeriod,
        dEventLimit100,
        dMaxEventLimitShare,
        dTSI,
        lTypeofLoadingFactor,
        dStoreTotalDepositPremium100,
        dStorePreviousDepositPremium100,
        bCoverageElementMandatory,
        nCountCoverageElement,
        bCoverageElementRequired,
        lPreviousTypeOfPremiumBasisKey,
        dw_loadts,
        row_number() over (
            partition by
                lPolicyLiabilityKey,
                lPolicySectionKey,
                lPolicyActivityKey,
                lPolicyKey,
                lPolicyFolderKey,
                lPolicyLiabilityChainKey,
                lAuthorityCheckJoinKey,
                bProductPriming,
                lAgreementLiabilityKey,
                lProductTemplateLiabilityKey,
                bMandatory,
                bPrintOnDecSheet,
                nOrder,
                bMasterLimit,
                bGetsMasterLimit,
                bLimitLessThanParentLimit,
                bDefaultedMasterLimitEditable,
                bRatedPremiumIsProRated,
                nPeriodDays,
                lTypeOfSubClassKey,
                lTypeOfPlacementKey,
                lTypeOfLimitBasisKey,
                lTypeOfClaimBasisKey,
                dLimit,
                dExcessOf,
                dExposure,
                dLimitAggregate,
                lPLTypeOfDeductibleKey,
                dDeductible,
                lDeductibleRatingLookupKey,
                lDeductibleTemplateRatingKey,
                lLiabilityPremiumCcyKey,
                dLiabilityPremiumROE,
                dPremiumSplitPc,
                bPremiumApplicable,
                bRated,
                bPremiumAggregated,
                lTypeOfRateKey,
                dLookedUpRate,
                lTemplateRatingKey,
                lRatingLookupKey,
                lTypeOfRatingBasisKey,
                dRatingBasisAmount,
                dPreviousRatingBasisAmount,
                dVersionRatingBasisAmount,
                dRatingModifier,
                lTypeOfPremiumBasisKey,
                dMinimumDepositPc,
                dVersionDepositPremium100,
                dVersionAdjustmentPremium100,
                dVersionBasePremium100,
                dVersionGrossThisTime100,
                dVersionRatedPremium100,
                dVersionAdditionsThisTime100,
                dVersionDeductionsThisTime100,
                dVersionAdditionsPayaway100,
                dVersionDeductionsPayaway100,
                dVersDednsPassedToInsured100,
                dVersionBrokerDeductible100,
                dVersionNetToInsured100,
                dVersionCashReceivable100,
                dVersionNetThisTime100,
                dVersionDeductionsThisTimeShareTT,
                dVersnDeductionsPayawayShareW,
                dVersionNetThisTimeShareTT,
                dVersionAdjustmentPremiumS,
                dVersionAdditionsPayawayShareS,
                dVerDednsPassedToInsuredShareS,
                dVersionBasePremiumShareTT,
                dVersionRatedPremiumShareTT,
                dVersionDepositPremiumShareTT,
                dVersionGrossThisTimeShareTT,
                dVersionAdditionsThisTimeShareTT,
                dVersionBrokerDeductibleShareT,
                dVersionNetToInsuredShareT,
                dVersionCashReceivableShareT,
                dPreviousDepositPremium100,
                dPreviousBasePremium100,
                dPreviousGrossThisTime100,
                dPreviousRatedPremium100,
                dPreviousAdditionsThisTime100,
                dPreviousDeductionsThisTime100,
                dPreviousNetThisTime100,
                dTotalDepositPremium100,
                dTotalBasePremium100,
                dTotalRatedPremium100,
                dTotalGrossThisTime100,
                dTotalAdditionsThisTime100,
                dTotalDeductionsThisTime100,
                dTotalNetThisTime100,
                dTotalDeductionsThisTimeShareTT,
                dTotalNetThisTimeShareTT,
                dTotalRatedPremiumShareTT,
                dTotalAdditionsThisTimeShareTT,
                dTotalBasePremiumShareTT,
                dTotalGrossThisTimeShareTT,
                lEPICurrencyKey,
                dEPIROE,
                dVersionGrossGrossWritten100,
                dVersionGrossGrossWrittenShareTT,
                dVersionDeductionsWritten100,
                dVersionDeductionsWrittenShareTT,
                dVersionNetWritten100,
                dVersionNetWrittenShareTT,
                lPLRiskSettlementCurrency,
                dPLRiskSettROE,
                dCurrentInstalmentTotal100,
                bBurningCosts,
                dLowerBurningCostRate,
                dUpperBurningCostRate,
                lTypeOfRateModifierBasisKey,
                nPolicyTermFullMonths,
                nPolicyTermPartMonths,
                nPolicyTermRemainingDays,
                bSponsored,
                lTerritoryKey,
                dMinimumPC,
                dVersionMinimumPremium100,
                dVersionMinimumPremiumShareTT,
                dPreviousMinimumPremium100,
                dTotalMinimumPremium100,
                dTotalMinimumPremiumShareTT,
                dVersionGrossGrossThisTime100,
                dVersionGrossGrossThisTimeShareTT,
                lProductTemplateSectionKey,
                dPreviousGrossGrossWritten100,
                dTotalGrossGrossWritten100,
                dTotalGrossGrossWrittenShareTT,
                dRate,
                dTotalDepositPremiumShareTT,
                dVersionRatedPremium100Save,
                dVersionGrossPremium100Save,
                dEPI100Save,
                bInheritDeductible,
                boverridable,
                dVersnGrossGrossPremium100Save,
                dLookedUpMasterRate,
                lMasterPolicyLiabilityKey,
                lPolicyLiabilityMasterRateKey,
                lMastPolLiabilityChainKey,
                lMasterTemplateRatingKey,
                lLimitCurrencyKey,
                dLimitCurrencyROE,
                lAreaKey,
                bBasePremiumAggregated,
                dtTransitFrom,
                dtTransitTo,
                nTransitDays,
                dLimitInBaseCcy,
                bDefaultRatingBasisAmtToLimit,
                sCoverage,
                sCoverageCode,
                dPreviousGrossGrossThisTime100,
                dTotalGrossGrossThisTime100,
                dTotalGrossGrossThisTimeShareTT,
                dPreviousAdditionsWritten100,
                dTotalAdditionsWritten100,
                dVersionAdditionsWritten100,
                dVersionAdditionsWrittenShareTT,
                dPreviousDeductionsWritten100,
                dTotalDeductionsWritten100,
                dTotalDeductionsWrittenShareTT,
                dPreviousNetWritten100,
                dTotalNetWritten100,
                dVersionGrossWritten100,
                dVersionGrossWrittenShareTT,
                dTotalGrossWritten100,
                dPreviousGrossWritten100,
                dTotalGrossWrittenShareTT,
                dTotalAdditionsWrittenShareTT,
                dTotalNetWrittenShareTT,
                bExcludeTaxDeduction,
                dAgreementLimit,
                dAgreementAggregateLimit,
                dVersionNetPremToInsurerShareTT,
                dVersionNetPremToInsurer100,
                dVersionWNetPremToInsurerShareTT,
                dVersionWNetPremToInsurer100,
                dRatedPremiumOverride,
                dActualRatedPremium100,
                bNewCoverage,
                bBinderCurrencyRestriction,
                lLimitAIOr100Key,
                dCoverageAmountPc,
                lCoveragePcOfSubClassKey,
                lTypeOfCoverageGreaterLessThanKey,
                lCoverageGreaterLessThanOperatorKey,
                dCoverageDailyAmount,
                nCoverageDays,
                nCoverageWaitingPeriodDays,
                dCoverageWaitingPeriodAmount,
                lExcessCurrencyKey,
                lExcessAIOr100Key,
                dExcessROE,
                bAsScheduledLimitOccurence,
                bAsScheduledExcessOf,
                bAsScheduledLimitAggregate,
                bAsScheduledDailyAmount,
                bAsScheduledNoOfDays,
                bAsScheduledWaitingPeriodDays,
                lTypeofDeductibleBasedOnKey,
                lDeductibleCcyKey,
                lDedductibleAIor100Key,
                dDeductiblePC,
                dMinDeductible,
                dMaxDeductible,
                bAsScheduledDeductible,
                bAsScheduledDeductiblePC,
                bAsScheduledDeductibleMin,
                bAsScheduledDeductibleMax,
                bAsScheduleWaitingPeriodAmount,
                lCoverageSetKey,
                bIsAIHidden,
                lTypeOfCoverageOptionKey,
                dOccurrenceCompareAmount,
                dPMLPC,
                lTypeOfCoverageComparisonKey,
                dCessionPc,
                bAsScheduledPMLPc,
                lPMLOption,
                lExcessOption,
                sCoverageNarrative,
                dGrossForPeriod,
                dGrossForPeriodSave,
                dReplaceGrossForPeriod,
                dEventLimit100,
                dMaxEventLimitShare,
                dTSI,
                lTypeofLoadingFactor,
                dStoreTotalDepositPremium100,
                dStorePreviousDepositPremium100,
                bCoverageElementMandatory,
                nCountCoverageElement,
                bCoverageElementRequired,
                lPreviousTypeOfPremiumBasisKey
            order by
                dw_loadts
        ) as dw_extract_order
    from
        policy_liability
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lPolicyLiabilityKey,
        lPolicySectionKey,
        lPolicyActivityKey,
        lPolicyKey,
        lPolicyFolderKey,
        lPolicyLiabilityChainKey,
        lAuthorityCheckJoinKey,
        bProductPriming,
        lAgreementLiabilityKey,
        lProductTemplateLiabilityKey,
        bMandatory,
        bPrintOnDecSheet,
        nOrder,
        bMasterLimit,
        bGetsMasterLimit,
        bLimitLessThanParentLimit,
        bDefaultedMasterLimitEditable,
        bRatedPremiumIsProRated,
        nPeriodDays,
        lTypeOfSubClassKey,
        lTypeOfPlacementKey,
        lTypeOfLimitBasisKey,
        lTypeOfClaimBasisKey,
        dLimit,
        dExcessOf,
        dExposure,
        dLimitAggregate,
        lPLTypeOfDeductibleKey,
        dDeductible,
        lDeductibleRatingLookupKey,
        lDeductibleTemplateRatingKey,
        lLiabilityPremiumCcyKey,
        dLiabilityPremiumROE,
        dPremiumSplitPc,
        bPremiumApplicable,
        bRated,
        bPremiumAggregated,
        lTypeOfRateKey,
        dLookedUpRate,
        lTemplateRatingKey,
        lRatingLookupKey,
        lTypeOfRatingBasisKey,
        dRatingBasisAmount,
        dPreviousRatingBasisAmount,
        dVersionRatingBasisAmount,
        dRatingModifier,
        lTypeOfPremiumBasisKey,
        dMinimumDepositPc,
        dVersionDepositPremium100,
        dVersionAdjustmentPremium100,
        dVersionBasePremium100,
        dVersionGrossThisTime100,
        dVersionRatedPremium100,
        dVersionAdditionsThisTime100,
        dVersionDeductionsThisTime100,
        dVersionAdditionsPayaway100,
        dVersionDeductionsPayaway100,
        dVersDednsPassedToInsured100,
        dVersionBrokerDeductible100,
        dVersionNetToInsured100,
        dVersionCashReceivable100,
        dVersionNetThisTime100,
        dVersionDeductionsThisTimeShareTT,
        dVersnDeductionsPayawayShareW,
        dVersionNetThisTimeShareTT,
        dVersionAdjustmentPremiumS,
        dVersionAdditionsPayawayShareS,
        dVerDednsPassedToInsuredShareS,
        dVersionBasePremiumShareTT,
        dVersionRatedPremiumShareTT,
        dVersionDepositPremiumShareTT,
        dVersionGrossThisTimeShareTT,
        dVersionAdditionsThisTimeShareTT,
        dVersionBrokerDeductibleShareT,
        dVersionNetToInsuredShareT,
        dVersionCashReceivableShareT,
        dPreviousDepositPremium100,
        dPreviousBasePremium100,
        dPreviousGrossThisTime100,
        dPreviousRatedPremium100,
        dPreviousAdditionsThisTime100,
        dPreviousDeductionsThisTime100,
        dPreviousNetThisTime100,
        dTotalDepositPremium100,
        dTotalBasePremium100,
        dTotalRatedPremium100,
        dTotalGrossThisTime100,
        dTotalAdditionsThisTime100,
        dTotalDeductionsThisTime100,
        dTotalNetThisTime100,
        dTotalDeductionsThisTimeShareTT,
        dTotalNetThisTimeShareTT,
        dTotalRatedPremiumShareTT,
        dTotalAdditionsThisTimeShareTT,
        dTotalBasePremiumShareTT,
        dTotalGrossThisTimeShareTT,
        lEPICurrencyKey,
        dEPIROE,
        dVersionGrossGrossWritten100,
        dVersionGrossGrossWrittenShareTT,
        dVersionDeductionsWritten100,
        dVersionDeductionsWrittenShareTT,
        dVersionNetWritten100,
        dVersionNetWrittenShareTT,
        lPLRiskSettlementCurrency,
        dPLRiskSettROE,
        dCurrentInstalmentTotal100,
        bBurningCosts,
        dLowerBurningCostRate,
        dUpperBurningCostRate,
        lTypeOfRateModifierBasisKey,
        nPolicyTermFullMonths,
        nPolicyTermPartMonths,
        nPolicyTermRemainingDays,
        bSponsored,
        lTerritoryKey,
        dMinimumPC,
        dVersionMinimumPremium100,
        dVersionMinimumPremiumShareTT,
        dPreviousMinimumPremium100,
        dTotalMinimumPremium100,
        dTotalMinimumPremiumShareTT,
        dVersionGrossGrossThisTime100,
        dVersionGrossGrossThisTimeShareTT,
        lProductTemplateSectionKey,
        dPreviousGrossGrossWritten100,
        dTotalGrossGrossWritten100,
        dTotalGrossGrossWrittenShareTT,
        dRate,
        dTotalDepositPremiumShareTT,
        dVersionRatedPremium100Save,
        dVersionGrossPremium100Save,
        dEPI100Save,
        bInheritDeductible,
        boverridable,
        dVersnGrossGrossPremium100Save,
        dLookedUpMasterRate,
        lMasterPolicyLiabilityKey,
        lPolicyLiabilityMasterRateKey,
        lMastPolLiabilityChainKey,
        lMasterTemplateRatingKey,
        lLimitCurrencyKey,
        dLimitCurrencyROE,
        lAreaKey,
        bBasePremiumAggregated,
        dtTransitFrom,
        dtTransitTo,
        nTransitDays,
        dLimitInBaseCcy,
        bDefaultRatingBasisAmtToLimit,
        sCoverage,
        sCoverageCode,
        dPreviousGrossGrossThisTime100,
        dTotalGrossGrossThisTime100,
        dTotalGrossGrossThisTimeShareTT,
        dPreviousAdditionsWritten100,
        dTotalAdditionsWritten100,
        dVersionAdditionsWritten100,
        dVersionAdditionsWrittenShareTT,
        dPreviousDeductionsWritten100,
        dTotalDeductionsWritten100,
        dTotalDeductionsWrittenShareTT,
        dPreviousNetWritten100,
        dTotalNetWritten100,
        dVersionGrossWritten100,
        dVersionGrossWrittenShareTT,
        dTotalGrossWritten100,
        dPreviousGrossWritten100,
        dTotalGrossWrittenShareTT,
        dTotalAdditionsWrittenShareTT,
        dTotalNetWrittenShareTT,
        bExcludeTaxDeduction,
        dAgreementLimit,
        dAgreementAggregateLimit,
        dVersionNetPremToInsurerShareTT,
        dVersionNetPremToInsurer100,
        dVersionWNetPremToInsurerShareTT,
        dVersionWNetPremToInsurer100,
        dRatedPremiumOverride,
        dActualRatedPremium100,
        bNewCoverage,
        bBinderCurrencyRestriction,
        lLimitAIOr100Key,
        dCoverageAmountPc,
        lCoveragePcOfSubClassKey,
        lTypeOfCoverageGreaterLessThanKey,
        lCoverageGreaterLessThanOperatorKey,
        dCoverageDailyAmount,
        nCoverageDays,
        nCoverageWaitingPeriodDays,
        dCoverageWaitingPeriodAmount,
        lExcessCurrencyKey,
        lExcessAIOr100Key,
        dExcessROE,
        bAsScheduledLimitOccurence,
        bAsScheduledExcessOf,
        bAsScheduledLimitAggregate,
        bAsScheduledDailyAmount,
        bAsScheduledNoOfDays,
        bAsScheduledWaitingPeriodDays,
        lTypeofDeductibleBasedOnKey,
        lDeductibleCcyKey,
        lDedductibleAIor100Key,
        dDeductiblePC,
        dMinDeductible,
        dMaxDeductible,
        bAsScheduledDeductible,
        bAsScheduledDeductiblePC,
        bAsScheduledDeductibleMin,
        bAsScheduledDeductibleMax,
        bAsScheduleWaitingPeriodAmount,
        lCoverageSetKey,
        bIsAIHidden,
        lTypeOfCoverageOptionKey,
        dOccurrenceCompareAmount,
        dPMLPC,
        lTypeOfCoverageComparisonKey,
        dCessionPc,
        bAsScheduledPMLPc,
        lPMLOption,
        lExcessOption,
        sCoverageNarrative,
        dGrossForPeriod,
        dGrossForPeriodSave,
        dReplaceGrossForPeriod,
        dEventLimit100,
        dMaxEventLimitShare,
        dTSI,
        lTypeofLoadingFactor,
        dStoreTotalDepositPremium100,
        dStorePreviousDepositPremium100,
        bCoverageElementMandatory,
        nCountCoverageElement,
        bCoverageElementRequired,
        lPreviousTypeOfPremiumBasisKey,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lPolicyLiabilityKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged