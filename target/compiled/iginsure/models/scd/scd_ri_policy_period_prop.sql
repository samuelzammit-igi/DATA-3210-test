-- This file is automatically generated

with

ri_policy_period_prop as (
    select * from "IGI_PROD_DW"."dbo"."RIPolicyPeriodProp"
),

ordered as (
    select
        lRIPolicyPeriodPropKey,
        lRIPolicyPeriodKey,
        lRIPolicyKey,
        lRIFolderKey,
        lPolicyRIProfileKey,
        lRISectionBrokerKey,
        lRISectionBrokerSecurityKey,
        lPolicyLiabilityKey,
        lClaimMovementKey,
        lEntityKey,
        lInstanceKey,
        lPolicyLineKey,
        lPolicyActivityKey,
        lPolicyLineLiabilityKey,
        lPolicyLineSectionKey,
        lInwardsCurrencyKey,
        dInwardsROE,
        dInwardsCessionPremiumS,
        dInwardsCessionPremiumW,
        dInwardsCessionPremiumT,
        dInwardsBrokerCommissionS,
        dInwardsBrokerCommissionW,
        dInwardsBrokerCommissionT,
        dInwardsCedingCommissionS,
        dInwardsCedingCommissionW,
        dInwardsCedingCommissionT,
        dInwardsOverridingCommissionS,
        dInwardsOverridingCommissionW,
        dInwardsOverridingCommissionT,
        dInwardsRecovery,
        dInwardsOSRecovery,
        dInwardsOSMovement,
        lOutwardsCurrencyKey,
        dOutwardsROE,
        dOutwardsCessionPremiumS,
        dOutwardsCessionPremiumW,
        dOutwardsCessionPremiumT,
        dOutwardsBrokerCommissionS,
        dOutwardsBrokerCommissionW,
        dOutwardsBrokerCommissionT,
        dOutwardsCedingCommissionS,
        dOutwardsCedingCommissionW,
        dOutwardsCedingCommissionT,
        dOutwardsOverridingCommissionS,
        dOutwardsOverridingCommissionW,
        dOutwardsOverridingCommissionT,
        dOutwardsCombinationDeductionT,
        dOutwardsRecovery,
        dOutwardsOSRecovery,
        dOutwardsOSMovement,
        lTransactionTypeKey,
        bInwardsRI,
        dSurplusCessionPC,
        lAccountsPayableReceivableKey,
        lTypeOfContraKey,
        lOrigRIPolicyPeriodPropKey,
        nLevel,
        nLayer,
        nSequence,
        lLayerGrossNetKey,
        lCommissionGrossNetKey,
        dCessionPC,
        dTreatyProportionPC,
        dOverridingCommissionPc,
        dCedingCommissionPc,
        dBrokerCommissionPc,
        lRIGrossNetOfCommissionKey,
        lPolicyKey,
        dGrossEquivalentCessionPC,
        bInError,
        bPosted,
        dtDue,
        lPolicyLineLiabilityInstalKey,
        dInwExcessOf,
        dInwLimit,
        dRIExcessOf,
        dRILimit,
        dLimitCessionProrataPC,
        bInErrorOverCeded,
        bInErrorNeedInwLimit,
        nParentLevel,
        nParentLayer,
        bPostedToAPRs,
        bPostedToJournals,
        lPolicySectionKey,
        bApplyLimitsToCessionPC,
        dRIAppliedLimit,
        dFinalCessionPC,
        lContraRIPolicyPeriodPropKey,
        dOverridePremiumCessionPC,
        dInwardsdDeductionAmountT,
        dInwardsNetPremiumT,
        dOutwardsDeductionAmountT,
        dOutwardsNetPremiumT,
        bReinstatement,
        lRIActivityKey,
        lPolicyBrokerSummaryKey,
        lPolicyActivityBrokerSummaryKey,
        lPolicyLineBrokerSummaryKey,
        lClaimMovementBrokerSummaryKey,
        dw_loadts,
        row_number() over (
            partition by
                lRIPolicyPeriodPropKey,
                lRIPolicyPeriodKey,
                lRIPolicyKey,
                lRIFolderKey,
                lPolicyRIProfileKey,
                lRISectionBrokerKey,
                lRISectionBrokerSecurityKey,
                lPolicyLiabilityKey,
                lClaimMovementKey,
                lEntityKey,
                lInstanceKey,
                lPolicyLineKey,
                lPolicyActivityKey,
                lPolicyLineLiabilityKey,
                lPolicyLineSectionKey,
                lInwardsCurrencyKey,
                dInwardsROE,
                dInwardsCessionPremiumS,
                dInwardsCessionPremiumW,
                dInwardsCessionPremiumT,
                dInwardsBrokerCommissionS,
                dInwardsBrokerCommissionW,
                dInwardsBrokerCommissionT,
                dInwardsCedingCommissionS,
                dInwardsCedingCommissionW,
                dInwardsCedingCommissionT,
                dInwardsOverridingCommissionS,
                dInwardsOverridingCommissionW,
                dInwardsOverridingCommissionT,
                dInwardsRecovery,
                dInwardsOSRecovery,
                dInwardsOSMovement,
                lOutwardsCurrencyKey,
                dOutwardsROE,
                dOutwardsCessionPremiumS,
                dOutwardsCessionPremiumW,
                dOutwardsCessionPremiumT,
                dOutwardsBrokerCommissionS,
                dOutwardsBrokerCommissionW,
                dOutwardsBrokerCommissionT,
                dOutwardsCedingCommissionS,
                dOutwardsCedingCommissionW,
                dOutwardsCedingCommissionT,
                dOutwardsOverridingCommissionS,
                dOutwardsOverridingCommissionW,
                dOutwardsOverridingCommissionT,
                dOutwardsCombinationDeductionT,
                dOutwardsRecovery,
                dOutwardsOSRecovery,
                dOutwardsOSMovement,
                lTransactionTypeKey,
                bInwardsRI,
                dSurplusCessionPC,
                lAccountsPayableReceivableKey,
                lTypeOfContraKey,
                lOrigRIPolicyPeriodPropKey,
                nLevel,
                nLayer,
                nSequence,
                lLayerGrossNetKey,
                lCommissionGrossNetKey,
                dCessionPC,
                dTreatyProportionPC,
                dOverridingCommissionPc,
                dCedingCommissionPc,
                dBrokerCommissionPc,
                lRIGrossNetOfCommissionKey,
                lPolicyKey,
                dGrossEquivalentCessionPC,
                bInError,
                bPosted,
                dtDue,
                lPolicyLineLiabilityInstalKey,
                dInwExcessOf,
                dInwLimit,
                dRIExcessOf,
                dRILimit,
                dLimitCessionProrataPC,
                bInErrorOverCeded,
                bInErrorNeedInwLimit,
                nParentLevel,
                nParentLayer,
                bPostedToAPRs,
                bPostedToJournals,
                lPolicySectionKey,
                bApplyLimitsToCessionPC,
                dRIAppliedLimit,
                dFinalCessionPC,
                lContraRIPolicyPeriodPropKey,
                dOverridePremiumCessionPC,
                dInwardsdDeductionAmountT,
                dInwardsNetPremiumT,
                dOutwardsDeductionAmountT,
                dOutwardsNetPremiumT,
                bReinstatement,
                lRIActivityKey,
                lPolicyBrokerSummaryKey,
                lPolicyActivityBrokerSummaryKey,
                lPolicyLineBrokerSummaryKey,
                lClaimMovementBrokerSummaryKey
            order by
                dw_loadts
        ) as dw_extract_order
    from
        ri_policy_period_prop
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lRIPolicyPeriodPropKey,
        lRIPolicyPeriodKey,
        lRIPolicyKey,
        lRIFolderKey,
        lPolicyRIProfileKey,
        lRISectionBrokerKey,
        lRISectionBrokerSecurityKey,
        lPolicyLiabilityKey,
        lClaimMovementKey,
        lEntityKey,
        lInstanceKey,
        lPolicyLineKey,
        lPolicyActivityKey,
        lPolicyLineLiabilityKey,
        lPolicyLineSectionKey,
        lInwardsCurrencyKey,
        dInwardsROE,
        dInwardsCessionPremiumS,
        dInwardsCessionPremiumW,
        dInwardsCessionPremiumT,
        dInwardsBrokerCommissionS,
        dInwardsBrokerCommissionW,
        dInwardsBrokerCommissionT,
        dInwardsCedingCommissionS,
        dInwardsCedingCommissionW,
        dInwardsCedingCommissionT,
        dInwardsOverridingCommissionS,
        dInwardsOverridingCommissionW,
        dInwardsOverridingCommissionT,
        dInwardsRecovery,
        dInwardsOSRecovery,
        dInwardsOSMovement,
        lOutwardsCurrencyKey,
        dOutwardsROE,
        dOutwardsCessionPremiumS,
        dOutwardsCessionPremiumW,
        dOutwardsCessionPremiumT,
        dOutwardsBrokerCommissionS,
        dOutwardsBrokerCommissionW,
        dOutwardsBrokerCommissionT,
        dOutwardsCedingCommissionS,
        dOutwardsCedingCommissionW,
        dOutwardsCedingCommissionT,
        dOutwardsOverridingCommissionS,
        dOutwardsOverridingCommissionW,
        dOutwardsOverridingCommissionT,
        dOutwardsCombinationDeductionT,
        dOutwardsRecovery,
        dOutwardsOSRecovery,
        dOutwardsOSMovement,
        lTransactionTypeKey,
        bInwardsRI,
        dSurplusCessionPC,
        lAccountsPayableReceivableKey,
        lTypeOfContraKey,
        lOrigRIPolicyPeriodPropKey,
        nLevel,
        nLayer,
        nSequence,
        lLayerGrossNetKey,
        lCommissionGrossNetKey,
        dCessionPC,
        dTreatyProportionPC,
        dOverridingCommissionPc,
        dCedingCommissionPc,
        dBrokerCommissionPc,
        lRIGrossNetOfCommissionKey,
        lPolicyKey,
        dGrossEquivalentCessionPC,
        bInError,
        bPosted,
        dtDue,
        lPolicyLineLiabilityInstalKey,
        dInwExcessOf,
        dInwLimit,
        dRIExcessOf,
        dRILimit,
        dLimitCessionProrataPC,
        bInErrorOverCeded,
        bInErrorNeedInwLimit,
        nParentLevel,
        nParentLayer,
        bPostedToAPRs,
        bPostedToJournals,
        lPolicySectionKey,
        bApplyLimitsToCessionPC,
        dRIAppliedLimit,
        dFinalCessionPC,
        lContraRIPolicyPeriodPropKey,
        dOverridePremiumCessionPC,
        dInwardsdDeductionAmountT,
        dInwardsNetPremiumT,
        dOutwardsDeductionAmountT,
        dOutwardsNetPremiumT,
        bReinstatement,
        lRIActivityKey,
        lPolicyBrokerSummaryKey,
        lPolicyActivityBrokerSummaryKey,
        lPolicyLineBrokerSummaryKey,
        lClaimMovementBrokerSummaryKey,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lRIPolicyPeriodPropKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged