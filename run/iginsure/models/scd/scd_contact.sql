create view "dbt_dev"."scd_contact__dbt_tmp" as
    -- This file is automatically generated



with

contact as (
    select * from "IGI_PROD_DW"."dbo"."Contact"
),

ordered as (
    select
        lContactKey,
        lAuthorityCheckJoinKey,
        sContactReference,
        sContactRefSearch,
        lTypeOfRoleKey,
        lTypeOfContactKey,
        lTypeOfContactLevelKey,
        lTypeOfUserKey,
        lSecurityUserKey,
        lManagerKey,
        sCompanyName,
        sCode,
        sNameOfMainContact,
        bBusinessIncorporated,
        lTypeOfCompanyKey,
        sForename,
        sSurname,
        lTypeOfTitleKey,
        lTypeOfTitleSuffixKey,
        lTypeOfGenderKey,
        dtBirth,
        lTypeOfOccupationKey,
        sInitials,
        sPosition,
        sPhone,
        sMobilePhone,
        sFax,
        sEmail,
        sWebSite,
        sToBeKnownAs,
        bKeyClient,
        bAttorneyTax1099,
        lRatingSourceKey,
        sTaxCode,
        bW9Tax,
        dtEffectiveFrom,
        dtCancelled,
        lBrokerGroupKey,
        bInBrokerGroup,
        sLedgerCodeSegment,
        sLedgerCodeUnit,
        sLedgerCodeLOB,
        sMailingAddressCareOf,
        lMailingAddressKey,
        sMailingAddress1,
        sMailingAddress2,
        sMailingAddressCity,
        sMailingAddressPostCode,
        lMailingAddressCityKey,
        lMailingAddressStateKey,
        lMailingAddressZipKey,
        lMailingAddressCountryKey,
        sBillingAddressCareOf,
        lBillingAddressKey,
        sBillingAddress1,
        sBillingAddress2,
        sBillingAddressCity,
        sBillingAddressPostCode,
        lBillingAddressCityKey,
        lBillingAddressStateKey,
        lBillingAddressZipKey,
        lBillingAddressCountryKey,
        lDomicileCountryKey,
        bDirectBroker,
        bReinsuranceBroker,
        bSurplusLinesBroker,
        bInwardsBroker,
        bInternalUserScreen,
        bPeerReview,
        bBillingAddressSameAsMailing,
        lTypeOfBillingKey,
        lTypeOfBrokerKey,
        lTypeOfSalesRegionKey,
        lTypeOfSICKey,
        sAdvisenFPN,
        sBillingAddressZipPlusFour,
        sDunnAndBradstreet,
        sMailingAddressZipPlusFour,
        sNIPRNumber,
        sStockSymbol,
        lUserDivisionKey,
        lSecurityBitfield,
        lUserSubDivisionKey,
        lDomicileStateKey,
        lBlobCompanyLogoKey,
        lBlobCompanyAddressKey,
        lLanguageKey,
        lInternalContactKey,
        lBlobNoteKey,
        lTypeOfRatingSourceValueKey,
        bGenerateCode,
        lAMLCompleteKey,
        lAMLCheckCOntactKey,
        dtAMLCheckPerformed,
        dtAMLCheckExipry,
        sAMLNotes,
        lTypeOfContactFunctionKey,
        lContactOwnerKey,
        sCountOfPrimaryRole,
        sCode2,
        sLogonID,
        bUnrestrictedInstancePermissn,
        lTypeOfAddressEntryKey,
        bBACountryHasStates,
        bMACountryHasStates,
        sCompanyLogo,
        sCompanyAddress,
        sNotes,
        bSelfServiceAvailable,
        nContactACRDefault,
        sLloydsSyndicateNo,
        sLloydsBrokerNo,
        sLloydsCoverholderPIN,
        sNAICCompanyCode,
        sFEINCode,
        sDUNSCode,
        sLIRMACode,
        sILUCode,
        sLloydsListCode,
        sIHSFairplayCode,
        bGeneralScreen,
        nPolicyAuthorityPrimaryCcySet,
        nClaimAuthorityPrimaryCcySet,
        lTypeofInsuredPolicyholderLloyds,
        nWriteOffCount,
        sCLASSUserId,
        sCLASSAccountCode,
        SSPECIALCHARACTERS,
        LMAINLOCATIONKEY,
        LTERRITORYKEY,
        bPossibleDuplicate,
        sLegalIdentifier,
        dtNextApproval,
        sPreviousContactReference,
        lCountryRiskLevel,
        bBrokerCodeValid,
        lsecurityuserkeywq,
        LWQSECURITYUSERKEY,
        sLegalName,
        dw_loadts,
        row_number() over (
            partition by
                lContactKey,
                lAuthorityCheckJoinKey,
                sContactReference,
                sContactRefSearch,
                lTypeOfRoleKey,
                lTypeOfContactKey,
                lTypeOfContactLevelKey,
                lTypeOfUserKey,
                lSecurityUserKey,
                lManagerKey,
                sCompanyName,
                sCode,
                sNameOfMainContact,
                bBusinessIncorporated,
                lTypeOfCompanyKey,
                sForename,
                sSurname,
                lTypeOfTitleKey,
                lTypeOfTitleSuffixKey,
                lTypeOfGenderKey,
                dtBirth,
                lTypeOfOccupationKey,
                sInitials,
                sPosition,
                sPhone,
                sMobilePhone,
                sFax,
                sEmail,
                sWebSite,
                sToBeKnownAs,
                bKeyClient,
                bAttorneyTax1099,
                lRatingSourceKey,
                sTaxCode,
                bW9Tax,
                dtEffectiveFrom,
                dtCancelled,
                lBrokerGroupKey,
                bInBrokerGroup,
                sLedgerCodeSegment,
                sLedgerCodeUnit,
                sLedgerCodeLOB,
                sMailingAddressCareOf,
                lMailingAddressKey,
                sMailingAddress1,
                sMailingAddress2,
                sMailingAddressCity,
                sMailingAddressPostCode,
                lMailingAddressCityKey,
                lMailingAddressStateKey,
                lMailingAddressZipKey,
                lMailingAddressCountryKey,
                sBillingAddressCareOf,
                lBillingAddressKey,
                sBillingAddress1,
                sBillingAddress2,
                sBillingAddressCity,
                sBillingAddressPostCode,
                lBillingAddressCityKey,
                lBillingAddressStateKey,
                lBillingAddressZipKey,
                lBillingAddressCountryKey,
                lDomicileCountryKey,
                bDirectBroker,
                bReinsuranceBroker,
                bSurplusLinesBroker,
                bInwardsBroker,
                bInternalUserScreen,
                bPeerReview,
                bBillingAddressSameAsMailing,
                lTypeOfBillingKey,
                lTypeOfBrokerKey,
                lTypeOfSalesRegionKey,
                lTypeOfSICKey,
                sAdvisenFPN,
                sBillingAddressZipPlusFour,
                sDunnAndBradstreet,
                sMailingAddressZipPlusFour,
                sNIPRNumber,
                sStockSymbol,
                lUserDivisionKey,
                lSecurityBitfield,
                lUserSubDivisionKey,
                lDomicileStateKey,
                lBlobCompanyLogoKey,
                lBlobCompanyAddressKey,
                lLanguageKey,
                lInternalContactKey,
                lBlobNoteKey,
                lTypeOfRatingSourceValueKey,
                bGenerateCode,
                lAMLCompleteKey,
                lAMLCheckCOntactKey,
                dtAMLCheckPerformed,
                dtAMLCheckExipry,
                sAMLNotes,
                lTypeOfContactFunctionKey,
                lContactOwnerKey,
                sCountOfPrimaryRole,
                sCode2,
                sLogonID,
                bUnrestrictedInstancePermissn,
                lTypeOfAddressEntryKey,
                bBACountryHasStates,
                bMACountryHasStates,
                sCompanyLogo,
                sCompanyAddress,
                sNotes,
                bSelfServiceAvailable,
                nContactACRDefault,
                sLloydsSyndicateNo,
                sLloydsBrokerNo,
                sLloydsCoverholderPIN,
                sNAICCompanyCode,
                sFEINCode,
                sDUNSCode,
                sLIRMACode,
                sILUCode,
                sLloydsListCode,
                sIHSFairplayCode,
                bGeneralScreen,
                nPolicyAuthorityPrimaryCcySet,
                nClaimAuthorityPrimaryCcySet,
                lTypeofInsuredPolicyholderLloyds,
                nWriteOffCount,
                sCLASSUserId,
                sCLASSAccountCode,
                SSPECIALCHARACTERS,
                LMAINLOCATIONKEY,
                LTERRITORYKEY,
                bPossibleDuplicate,
                sLegalIdentifier,
                dtNextApproval,
                sPreviousContactReference,
                lCountryRiskLevel,
                bBrokerCodeValid,
                lsecurityuserkeywq,
                LWQSECURITYUSERKEY,
                sLegalName
            order by
                dw_loadts
        ) as dw_extract_order
    from
        contact
),

filtered as (
    select * from ordered where dw_extract_order = 1
),

ranged as (
    select
        lContactKey,
        lAuthorityCheckJoinKey,
        sContactReference,
        sContactRefSearch,
        lTypeOfRoleKey,
        lTypeOfContactKey,
        lTypeOfContactLevelKey,
        lTypeOfUserKey,
        lSecurityUserKey,
        lManagerKey,
        sCompanyName,
        sCode,
        sNameOfMainContact,
        bBusinessIncorporated,
        lTypeOfCompanyKey,
        sForename,
        sSurname,
        lTypeOfTitleKey,
        lTypeOfTitleSuffixKey,
        lTypeOfGenderKey,
        dtBirth,
        lTypeOfOccupationKey,
        sInitials,
        sPosition,
        sPhone,
        sMobilePhone,
        sFax,
        sEmail,
        sWebSite,
        sToBeKnownAs,
        bKeyClient,
        bAttorneyTax1099,
        lRatingSourceKey,
        sTaxCode,
        bW9Tax,
        dtEffectiveFrom,
        dtCancelled,
        lBrokerGroupKey,
        bInBrokerGroup,
        sLedgerCodeSegment,
        sLedgerCodeUnit,
        sLedgerCodeLOB,
        sMailingAddressCareOf,
        lMailingAddressKey,
        sMailingAddress1,
        sMailingAddress2,
        sMailingAddressCity,
        sMailingAddressPostCode,
        lMailingAddressCityKey,
        lMailingAddressStateKey,
        lMailingAddressZipKey,
        lMailingAddressCountryKey,
        sBillingAddressCareOf,
        lBillingAddressKey,
        sBillingAddress1,
        sBillingAddress2,
        sBillingAddressCity,
        sBillingAddressPostCode,
        lBillingAddressCityKey,
        lBillingAddressStateKey,
        lBillingAddressZipKey,
        lBillingAddressCountryKey,
        lDomicileCountryKey,
        bDirectBroker,
        bReinsuranceBroker,
        bSurplusLinesBroker,
        bInwardsBroker,
        bInternalUserScreen,
        bPeerReview,
        bBillingAddressSameAsMailing,
        lTypeOfBillingKey,
        lTypeOfBrokerKey,
        lTypeOfSalesRegionKey,
        lTypeOfSICKey,
        sAdvisenFPN,
        sBillingAddressZipPlusFour,
        sDunnAndBradstreet,
        sMailingAddressZipPlusFour,
        sNIPRNumber,
        sStockSymbol,
        lUserDivisionKey,
        lSecurityBitfield,
        lUserSubDivisionKey,
        lDomicileStateKey,
        lBlobCompanyLogoKey,
        lBlobCompanyAddressKey,
        lLanguageKey,
        lInternalContactKey,
        lBlobNoteKey,
        lTypeOfRatingSourceValueKey,
        bGenerateCode,
        lAMLCompleteKey,
        lAMLCheckCOntactKey,
        dtAMLCheckPerformed,
        dtAMLCheckExipry,
        sAMLNotes,
        lTypeOfContactFunctionKey,
        lContactOwnerKey,
        sCountOfPrimaryRole,
        sCode2,
        sLogonID,
        bUnrestrictedInstancePermissn,
        lTypeOfAddressEntryKey,
        bBACountryHasStates,
        bMACountryHasStates,
        sCompanyLogo,
        sCompanyAddress,
        sNotes,
        bSelfServiceAvailable,
        nContactACRDefault,
        sLloydsSyndicateNo,
        sLloydsBrokerNo,
        sLloydsCoverholderPIN,
        sNAICCompanyCode,
        sFEINCode,
        sDUNSCode,
        sLIRMACode,
        sILUCode,
        sLloydsListCode,
        sIHSFairplayCode,
        bGeneralScreen,
        nPolicyAuthorityPrimaryCcySet,
        nClaimAuthorityPrimaryCcySet,
        lTypeofInsuredPolicyholderLloyds,
        nWriteOffCount,
        sCLASSUserId,
        sCLASSAccountCode,
        SSPECIALCHARACTERS,
        LMAINLOCATIONKEY,
        LTERRITORYKEY,
        bPossibleDuplicate,
        sLegalIdentifier,
        dtNextApproval,
        sPreviousContactReference,
        lCountryRiskLevel,
        bBrokerCodeValid,
        lsecurityuserkeywq,
        LWQSECURITYUSERKEY,
        sLegalName,
        dw_loadts as _valid_from,
        lead(dw_loadts) over (partition by lContactKey order by dw_loadts) as _valid_to
    from
        filtered
)

select * from ranged
